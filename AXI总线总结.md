## 綜述

**本文參考分析整理總結了AMBA AXI and ACE Protocol Specification文檔的AXI總線協議規範部分，錯誤之處歡迎指出。**

AMBA AXI協議支持高性能高頻的系統設計，該協議擁有以下優點：

* 適合高帶寬和低延遲的設計
* 不需要複雜的橋即可提供高頻操作
* 可以滿足多種組件的接口需求
* 適合高初始訪問延遲的存儲器控制器
* 提供互聯架構實現的靈活性
* 向後兼容AHB與APB接口

同時，該協議還擁有以下特點：

* 分離的地址/控制和數據階段
* 通過使用字節選通信號的方式支持非對齊數據傳輸
* 使用突發傳輸時只需要傳輸起始地址
* 允許地址信息提前於實際數據傳輸發送
* 分離的讀寫數據通道，這可以提供低損耗的DMA
* 支持發出多個未完成的地址
* 支持亂序傳輸完成
* 允許簡單添加寄存器階段以提供時序收斂

AXI協議同時包含了低功耗操作所需的信號擴展，也包含了AXI4-Lite協議，該協議是AXI4的子集，有著更簡單的控制寄存器接口和組件。

## AXI通道簡述

### 綜述

AXI協議基於突發傳輸，定義了下列獨立事務（一個事務可能包含多次傳輸）通道：

* 讀地址
* 讀數據
* 寫地址
* 寫數據
* 寫響應

地址通道攜帶描述被傳輸數據性質的控制信息，數據在主設備和從設備間通過以下方式傳輸：

1. 寫數據通道從主設備傳輸數據到從設備，在寫傳輸時，從設備使用寫響應通道通知主設備傳輸完成。
2. 讀數據通道從從設備傳輸數據到主設備。

寫數據的過程如下圖所示：

![avatar](pic/1.png)

讀數據的過程如下圖所示：

![avatar](pic/2.png)

每一個通道都擁有自己的VALID與READY信號用於實現握手，其中VALID信號表示通道的地址、數據或控制信息已經可用，而READY信號則表示接收方已準備好接收信息，其中，讀數據和寫數據通道還擁有LAST信號，該信號用於指示當前傳輸是否為當前事務中的最後一次傳輸。

### 讀地址與寫地址通道

讀事務與寫事務都擁有其自己的地址通道，對應的地址通道會攜帶一次事務所需的全部地址和控制信息。

### 讀數據通道

讀數據通道攜帶從設備傳送給主設備的數據和響應信息，該通道包括兩部分：

1. 位寬可為8、16、32、64、128、256、512、1024bit的數據總線。
2. 表示讀事務完成狀態的讀響應信號。

### 寫數據通道

寫數據通道攜帶主設備傳送給從設備的數據，該通道包括兩部分：

1. 位寬可為8、16、32、64、128、256、512、1024bit的數據總線。
2. 為每一個8bit數據準備的字節選通信號，用於指示數據的哪幾個字節是有效的。

寫數據通道總是被buffer的，因此主設備可以在未收到前一次寫事務的從設備響應消息時再次執行寫操作。

### 寫響應通道

從設備使用寫響應通道回應寫事務，全部的寫事務都需要寫響應通道的完成信號，並且完成信號僅在一個寫事務徹底完成時才產生，而並不會在每次數據傳輸時都產生。

## AXI互聯結構

一個典型的AXI系統結構如下：

![avatar](pic/3.png)

AXI協議為以下接口提供了單一的接口定義：

* 在主設備和互聯器（Interconnect）之間
* 在從設備和互聯器之間
* 在主設備和從設備之間

該接口定義支持不同的互聯器實現，設備之間的互聯器等效於另一個擁有對稱主端口和從端口的設備，真正的主設備和從設備可以連接到對應的端口。

大多數的系統使用如下三種互聯拓撲之一：

* 共享的地址和數據總線
* 共享的地址總線以及多條數據總線
* 多層，具有多個地址和數據總線

在大多數的系統中，地址通道帶寬需求遠小於數據通道帶寬需求。使用共享總線以及多條數據總線的拓撲結構實現並行數據傳輸時，可以在系統效率和互聯複雜性間取得平衡。

## AXI中使用寄存器切片

每一個AXI通道都只能單項傳輸信息，並且架構並沒有要求各個通道間具有固定的時序依賴要求。因此，寄存器切片可以插入到任何通道的任何位置，不過這會帶來額外的延遲（Latency）。

以下兩點是可能的：

* 在延遲和最大操作頻率之間取得平衡。
* 在處理器和高性能存儲器之間實現直接而又快速的鏈接，但同時又使用寄存器切片隔離性能不敏感外設的長路徑。

## AXI術語

### AXI組件與拓撲

下列術語描述了AXI組件：

* 組件（Component）
* 主組件（Master component）
* 從組件（Slave component），從組件包含存儲器子組件和外設子組件
* 互聯組件

對於特定的AXI傳輸，上游（Upstream）與下游（Downstream）指代AXI拓撲中AXI組件的相對位置。

### AXI傳輸與存儲器類型

當AXI主設備發起AXI操作時，對於AXI從設備：

* AXI總線上所需的完整操作集形成AXI事務（Transaction）。
* 任何傳輸的有效數據都作為一次AXI突發傳輸（Burst）。
* 一次突發傳輸可以包含多次數據傳輸，一次數據傳輸稱為一拍（Beat）。

## AXI信號描述

下列信號被用於AXI3和AXI4。

### 公共信號

| 信號名 | 來源 | 描述 |
| :-----: | :----: | :------------------: |
| ACLK | 時鐘源 | 公共時鐘信號 |
| ARESETn | 復位源 | 公共復位信號，低有效 |

**所有信號都在公共時鐘的上升沿被採樣。**

### 寫地址通道信號

| 信號名 | 來源 | 描述 |
| :------: | :----: | :----------------------------------------------------------------------------: |
| AWID | 主設備 | 寫地址ID，該信號用於標識寫地址組 |
| AWADDR | 主設備 | 寫地址，寫突發操作中第一次數據傳輸的地址 |
| AWLEN | 主設備 | 突發長度，這個字段標識每次突發傳輸的傳輸次數 |
| AWSIZE | 主設備 | 突發大小，這個字段表示每次突發傳輸的大小 |
| AWBURST | 主設備 | 突發類型，包括突發類型和突發大小信息，該字段決定了每次突發傳輸時地址的計算方法 |
| AWLOCK | 主設備 | 鎖定類型，提供關於傳輸時原子特性的額外信息 |
| AWCACHE | 主設備 | 存儲器類型 |
| AWPROT | 主設備 | 保護類型 |
| AWQOS | 主設備 | 服務質量，即每次寫傳輸的QoS標識符，僅AXI4支持 |
| AWREGION | 主設備 | 區域標識符，允許一個從設備的單個物理接口用作多個邏輯接口，僅AXI4支持 |
| AWUSER | 主設備 | 用戶定義信號，可選 |
| AWVALID | 主設備 | 主設備給出的地址和相關控制信號有效 |
| AWREADY | 從設備 | 從設備已準備好接收地址和相關的控制信號 |

### 寫數據通道信號

| 信號名 | 來源 | 描述 |
| :----: | :----: | :--------------------------------------------------: |
| WID | 主設備 | 寫數據ID，該信號用於標識寫數據傳輸，僅AXI3支持 |
| WDATA | 主設備 | 寫出的數據 |
| WSTRB | 主設備 | 數據的字節選通，數據中每8bit對應這裡的1bit |
| WLAST | 主設備 | 該信號用於標識當前傳輸是否為突發傳輸中的最後一次傳輸 |
| WUSER | 主設備 | 用戶定義信號，可選 |
| WVALID | 主設備 | 主設備給出的數據和字節選通信號有效 |
| WREADY | 從設備 | 從設備已準備好接收數據選通信號 |

### 寫響應通道信號

| 信號名 | 來源 | 描述 |
| :----: | :----: | :--------------------------------: |
| BID | 從設備 | 寫響應ID，該信號用於標識寫響應傳輸 |
| BRESP | 從設備 | 寫響應，該信號表示寫傳輸的狀態 |
| BUSER | 從設備 | 用戶定義信號，可選 |
| BVALID | 從設備 | 從設備給出的寫響應信號有效 |
| BREADY | 主設備 | 主設備已準備好接收寫響應信號 |

### 讀地址通道信號

| 信號名 | 來源 | 描述 |
| :------: | :----: | :----------------------------------------------------------------------------: |
| ARID | 主設備 | 讀地址ID，該信號用於標識讀地址組 |
| ARADDR | 主設備 | 讀地址，讀突發操作中第一次數據傳輸的地址 |
| ARLEN | 主設備 | 突發長度，這個字段標識每次突發傳輸的傳輸次數 |
| ARSIZE | 主設備 | 突發大小，這個字段表示每次突發傳輸的大小 |
| ARBURST | 主設備 | 突發類型，包括突發類型和突發大小信息，該字段決定了每次突發傳輸時地址的計算方法 |
| ARLOCK | 主設備 | 鎖定類型，提供關於傳輸時原子特性的額外信息 |
| ARCACHE | 主設備 | 存儲器類型 |
| ARPROT | 主設備 | 保護類型 |
| ARQOS | 主設備 | 服務質量，即每次讀傳輸的QoS標識符，僅AXI4支持 |
| ARREGION | 主設備 | 區域標識符，允許一個從設備的單個物理接口用作多個邏輯接口，僅AXI4支持 |
| ARUSER | 主設備 | 用戶定義信號，可選 |
| ARVALID | 主設備 | 主設備給出的地址和相關控制信號有效 |
| ARREADY | 從設備 | 從設備已準備好接收地址和相關的控制信號 |

### 讀數據通道信號

| 信號名 | 來源 | 描述 |
| :----: | :----: | :--------------------------------------------------: |
| RID | 從設備 | 讀數據ID，該信號用於標識讀數據傳輸 |
| RDATA | 從設備 | 讀出的數據 |
| RRESP | 從設備 | 讀響應，這信號表示讀傳輸的狀態 |
| RLAST | 從設備 | 該信號用於標識當前傳輸是否為突發傳輸中的最後一次傳輸 |
| RUSER | 從設備 | 用戶定義信號，可選 |
| RVALID | 從設備 | 從設備給出的數據和響應信息有效 |
| RREADY | 主設備 | 主設備已準備好接收讀取的數據和響應信息 |

### 低功耗接口信號

| 信號名 | 來源 | 描述 |
| :-----: | :--------: | :------------------------------------------------------------------------------: |
| CSYSREQ | 時鐘控制器 | 系統退出低功耗狀態請求，外設的系統時鐘控制器通過該信號發出請求用於離開低功耗狀態 |
| CSYSACK | 外設 | 退出低功耗狀態響應，外設響應系統低功耗狀態退出請求時使用的信號 |
| CACTIVE | 外設 | 時鐘激活，該信號表示外設需要時鐘信號 |

## 單接口需求

這一部分描述了單個主設備和單個從設備之間的基本AXI協議事務需求。

### 時鐘

每個AXI組件都需要一個時鐘信號ACLK，全部的信號都在ACLK的上升沿被採樣，一切輸出信號都必須在ACLK的上升沿之後發生改變。

在主從接口之間的輸入輸出信號間不能有組合路徑。

### 復位

AXI協議使用低有效復位信號ARESETn，該信號是可以異步拉低，但必須在ACLK的上升沿同步釋放。

在復位期間，下列信號需要遵循特定的要求：

* 主接口必須拉低ARVALID、AWVALID與WVALID信號。
* 從接口必須拉低RVALID與BVALID信號。
* 其它信號則可以為任意值。

在ARESETn被釋放後的下一個時鐘上升沿，主設備可以拉高ARVALID、AWVALID與WVALID信號，如下圖所示：

![avatar](pic/4.png)

### 基本讀寫事務

#### 握手過程

五個事務通道都使用VALID/READY作為握手信號，傳輸地址、數據和控制信息，使用這種握手方式，主從雙方都可以對傳輸速度進行控制。源端產生VALID信號意味著其地址、數據或控制信息有效，目的端產生READY信號意味著它可以接收信息，只有當雙方的VALID與READY信號都為高時傳輸才會開始。

**在主從接口之間的輸入輸出信號間不能有組合路徑。**

在下圖中，源端在T1之後給出地址、數據或控制信息，並令VALID有效，在T2之後，目的端檢測到VALID有效並給出READY有效信息，在T3階段傳輸會發生，因此在T3階段及之前，源端不能釋放或改變需要傳輸的信息。

![avatar](pic/5.png)

**源端必須在令VALID信號有效之後再等待READY信號有效，一旦VALID有效，源端必須等待握手發生，即在保持VALID不變的情況下，等待目的端的READY信號有效。**

在下圖中，目的端首先在T1階段之後令READY信號有效，源端在T2階段之後給出地址、數據或控制信息，並令VALID有效，然後在T3階段開始傳輸，在這種情況下，傳輸只消耗了一個時鐘週期，而在上面那種情況下，則消耗了兩個時鐘週期。

![avatar](pic/6.png)

**目的端可以在自身READY信號無效的情況下，等待源端的VALID信號有效，這一條規則和上一條規則必須同時遵守，否則可能造成死鎖等待，同時，在VALID有效前，即使READY已經有效，也可以再次令READY無效。**

在下圖中，兩端的VALID/READY信號同時有效，則傳輸立刻在下一個時鐘週期開始：

![avatar](pic/7.png)

#### 通道信號需求

每個通道都有自己的握手信號對：

* 寫地址通道：AWVALID/AWREADY。
* 寫數據通道：WVALID/WREADY。
* 寫響應通道：BVALID/BREADY。
* 讀地址通道：ARVALID/ARREADY。
* 讀數據通道：RVALID/RREADY。

寫地址通道：

主設備僅當輸出有效的地址和控制信息時才能使能AWVALID信號，在從設備的AWREADY信號有效後的第一個時鐘上升沿，主設備的AWVALID信號必須保持有效。

AWREADY信號的默認狀態可以為高也可以為低電平，規範推薦默認狀態為高電平。當該信號為高電平時，意味著從設備一定可以接受任何有效的地址。

**注意：規範不推薦AWREADY信號默認為低電平是因為這會強制使傳輸週期拉長到至少兩個時鐘週期，一個週期用於使能AWVALID信號，另一個週期則用於使能AWREADY信號。**

寫數據通道：

在寫突發過程中，主設備可以僅當它輸出有效數據時才使能WVALID信號，同樣的，該信號必須在從設備WREADY信號有效後的第一個時鐘上升沿保持有效。

WREADY信號默認可以為高電平，但這意味著從設備總是可以在一個時鐘週期內接收待寫入的數據。

主設備在進行突發事務中的最後一次寫傳輸時，必須令WLAST信號有效。

寫響應通道：

從設備輸出有效的寫響應信號後才能驅動BVALID信號，該信號在BREADY信號有效後的第一個時鐘上升沿保持有效。

BREADY信號默認可以為高電平，但此時主設備必須總能在一個時鐘週期內接收寫響應。

讀地址通道：

主設備僅當輸出有效的地址和控制信息時才能使能ARVALID信號，在從設備的AWREADY信號有效後的第一個時鐘上升沿，主設備的ARVALID信號必須保持有效。

ARREADY信號的默認狀態可以為高也可以為低電平，規範推薦默認狀態為高電平。當該信號為高電平時，意味著從設備一定可以接受任何有效的地址。

**注意：規範不推薦ARREADY信號默認為低電平是因為這會強制使傳輸週期拉長到至少兩個時鐘週期，一個週期用於使能ARVALID信號，另一個週期則用於使能ARREADY信號。**

讀數據通道：

從設備只有在輸出有效讀數據時才能使能RVALID信號，同時在主設備的RREADY信號有效後的第一個時鐘上升沿必須保持有效。**即使從設備只有一個讀數據源，它也必須在收到數據請求時才令RVALID信號有效。**

主接口使用RREADY信號表示它可以接收數據，RREADY信號默認可以為高電平，但此時主設備啓動讀事務時必須能立即接收數據。

從設備在進行突發傳輸事務中的最後一次傳輸時必須使能RLAST信號。


### 通道間的關係

AXI協議要求各個通道間必須保持如下關係：

* 寫響應必須緊跟在其所屬的寫事務的最後一次寫傳輸之後。
* 讀數據必須緊跟著它的地址之後。
* 通道握手必須符合通道握手依賴關係。

除此之外，協議沒有規定其它的任何關係，這意味著，在一個事務中，寫數據信號可以提前於寫地址信號，這種情況通常發生在寫地址的通道的寄存器階段要更多時， 同樣，寫數據可以和寫地址信號同時出現。

**注意：當互聯器需要決定目標地址空間或從設備地址空間時，必須對地址和寫數據重排，以確保寫數據僅對其關聯的從設備有效。**

### 通道握手信號依賴關係

為了避免死鎖，下列依賴規則必須遵守：

在任何事務中：

* 發送信息的AXI接口的VALID信號不能依賴於接收信息的AXI接口的READY信號。
* 接收信號的的AXI接口在其自身的READY信號有效前可以等待對方的VALID信號。

**注意：VALID信號可以在READY信號之前有效，READY信號也可以在檢測VALID信號之前有效，這些方式都會提升傳輸效率。**

在下面的依賴圖中：

* 單頭箭頭指向的信號可以在始端信號有效前或有效後有效。
* 雙頭箭頭指向的信號只有在始端信號有效後才能有效。

#### 讀傳輸依賴

在讀傳輸中：

* 主設備在使能ARVALID前不能等待從設備使能ARREADY。
* 從設備在使能自身的ARREADY前可以等待主設備使能ARVALID。
* 從設備可以在主設備使能ARVALID前使能ARREADY。
* 從設備在使能RVALID前必須等待ARVALID和ARREADY信號都使能。
* 從設備在使能RVALID後才能等待主設備使能RREADY。
* 主設備在使能RREADY前可以等待從設備使能RVALID。
* 主設備在從設備使能RVALID前可以使能RREADY。

總結就是：VALID信號發出方，必須首先使能VALID，才能等待READY信號；READY信號發出方，不必等待VALID有效，就可以發出READY信號，也可以等待VALID有效，再發出READY信號，同時，讀數據通道的VALID信號不能保持常態有效。

依賴關係圖如下：

![avatar](pic/8.png)

#### 寫傳輸依賴

* 主設備在使能AWVALID或WVALID後才能等待從設備使能AWREADY或WREADY。
* 從設備在使能AWREADY前可以等待AWVALID或WVALID有效。
* 從設備在AWVALID或WVALID有效前可以先使能AWREADY。
* 從設備可以在使能WREADY前等待AWVALID與WVALID有效。
* 從設備在AWVALID或WVALID有效前可以先使能WREADY。
* 從設備必須等待WVALID與WREADY都有效後才能使能BVALID。
* 從設備必須等待WLAST有效後才能使能BVALID，因為寫響應必須發生在一次寫事務中的最後一次數據傳輸後。
* 從設備必須在使能BVALID後才能等待主設備使能BREADY。
* 主設備可以在使能BREADY前等待BVALID。
* 主設備可以在BVALID有效前使能BREADY。

依賴關係圖如下：

![avatar](pic/9.png)

#### AXI4寫響應依賴

注意：

* 該額外的依賴關係是AXI3所期望的，因為AXI3不希望任何組件在接收到有效的地址前接收寫數據並提供寫響應信號（由於AXI3允許寫數據和寫響應在寫地址被接受前發出，因此AXI4從設備與AXI3從設備不完全兼容，而主設備則完全兼容，強烈推薦AXI3從設備按照更嚴格的AXI4寫響應依賴圖實現）。
* 通過發出寫響應，從設備負責對寫事務和所有後續事務進行冒險檢查。

依賴關係如下：

* 主設備在使能AWVALID或WVALID後才能等待從設備使能AWREADY或WREADY。
* 從設備在使能AWREADY前可以等待AWVALID或WVALID有效。
* 從設備可以在使能WREADY前等待AWVALID與WVALID有效。
* 從設備在AWVALID或WVALID有效前可以先使能WREADY。
* 從設備等待AWVALID、AWREADY、WVALID、WREADY有效後才能使能BVALID。
* 從設備必須等待WLAST有效後才能使能BVALID，因為寫響應必須發生在一次寫事務中的最後一次數據傳輸後。
* 從設備必須在使能BVALID後才能等待主設備使能BREADY。
* 主設備可以在使能BREADY前等待BVALID。
* 主設備可以在BVALID有效前使能BREADY。

依賴關係圖如下：

![avatar](pic/10.png)

### 事務結構

#### 地址結構

AXI協議是基於突發的，主設備向從設備傳送事務的控制信息和第一個字節的地址，然後，從設備必須在此後的每次傳輸中計算數據地址。

突發傳輸不能跨越4KB地址邊界。

**注意：避免突發傳輸跨越兩個從設備的邊界，同時，必須使用從設備支持的地址增量。**

突發長度：

突發長度由下列字段指定：

* 對於讀傳輸，ARLEN[7:0]。
* 對於寫傳輸：AWLEN[7:0]。

AXI3支持1~16的突發長度。

AXI4：

* 對於INCR突發類型，支持1~256的突發長度。
* 對於其它突發類型，支持1~16的突發長度。

AXI3中的突發長度定義如下：

突發長度 = AxLEN[3:0] + 1

AXI4中的突發長度定義如下：

突發長度 = AxLEN[7:0] + 1

在使用突發傳輸時，必須遵守如下規則：

* 對於回繞傳輸，突發長度必須為2、4、8或16。
* 突發傳輸不能跨越4KB地址邊界。
* 突發傳輸不支持過早結束。

在AXI4中，突發類型為INCR且突發長度大於16的突發傳輸可以轉換為多個長度更短的突發傳輸，即使突發屬性表明事務是不可修改的。在這種情況下，生成的突發事務必須保持與原始事務相同的事務特徵，唯一的例外是：

* 突發長度變小。
* 突發地址被適當調整。

**注意：為了實現AXI3兼容性，將長突發傳輸轉換為多個短突發傳輸是必要的，同時，這也可以減少長突發對QoS保證的影響。**

突發大小：

該字段表示每次突發數據傳輸或每個節拍中中數據的字節數，由以下字段指定：

* 對於讀傳輸，ARSIZE[2:0]。
* 對於寫傳輸，AWSIZE[2:0]。

突發大小 = 2^AxSIZE

如果AXI的總線比突發大小寬，AXI接口每次傳輸就必鬚根據地址判斷使用哪幾條數據線，任何一次傳輸的大小都不能超過事務中任一代理的數據總線寬度。

突發類型：

AXI協議定義了三種突發類型：

* 固定（FIXED）：在突發事務中，每次傳輸的地址一致，有效的字節線也是一致的，但是可以通過WSTRB信號控制實際有效的字節。這種方式通常用於對同一位置的重復訪問，如讀取或清空FIFO時。
* 遞增（INCR）：在一次遞增突發事務中，每次傳輸，地址都會在之前的地址基礎上遞增，遞增量為傳輸大小。
* 回繞（WRAP）：這種類型和遞增方式類似，但是，地址到達上界後，地址就會回繞到下界。

在回繞傳輸中，有幾點需要注意：

* 起始地址必須對齊突發大小。
* 突發長度必須為2、4、8或16。

回繞突發方式的行為如下：

* 突發所使用的地址下界會對齊到傳輸數據的總量，這也被稱為回繞邊界。
* 在每次傳輸後，地址都會像遞增突發方式一樣遞增，但是，一旦遞增後的地址超過回繞邊界，就會回到回繞邊界的開始位置。
* 第一次傳輸的地址可以大於回繞邊界的開始位置。

回繞突發方式通常用於Cache行的訪問。

突發類型由如下字段指定：

* 對於讀傳輸，ARBURST[1:0]。
* 對於寫傳輸，AWBURST[1:0]。

字段取值如下：

| AxBURST[1:0] | 突發類型 |
| :----------: | :------: |
| 00 | FIXED |
| 01 | INCR |
| 10 | WRAP |
| 11 | 保留 |

#### 數據讀寫結構

**寫選通：**

當WSTRB[i]為高電平時，對應的WDATA[(8i+7):8i]數據線有效，當WVALID為低電平時，寫選通信號可以為任何值，不過標準推薦寫選通信號全0或保持上一次的值。

**狹窄傳輸（Narrow transfer）：**

當主設備產生一個數據寬度小於數據總線的傳輸時，地址和控制信號按照如何方式決定使用哪些字節線：

* 在遞增或回繞突發模式中，每拍使用不同的字節線。
* 在固定突發模式中，每拍使用相同的字節線。

**字節不變性（Byte invariance）：**

在訪問單個存儲器空間中的大小端混合數據時，AXI協議使用字節不變性大小端模式。

字節不變性大小端模式是指：

* 數據元素使用相同連續的內存字節，而不管數據的大小端如何。
* 大小端決定了存儲器中的字節順序，也就是說存儲器中的第一個字節是數據元素的MSB還是LSB。
* 字節傳輸時，只需要將字節傳輸到地址給定的位置，而不需要考慮該字節是數據元素的哪一部分。

通常情況下，大多數小端組件可以直接連接到一個字節不變性接口，而只支持大端的組件則需要一個轉換器。

**非對齊傳輸：**

AXI支持非對齊傳輸，對於任何數據寬度大於一個字節的突發傳輸而言，第一個字節的訪問都可能是非對齊的。

一個主設備可以：

* 使用低位地址線發送一個非對齊的開始地址。
* 提供對齊的地址並使用字節選通信號線發送非對齊的開始地址。

注意：

* 低位地址線上的信息必須與字節選通信號提供的信息一致。
* 從設備不需要根據主設備傳遞的對齊信息執行任何特別的動作。

#### 數據讀寫響應結構

AXI協議提供了讀寫事務中的響應信號：

* 對於讀事務而言，從設備在讀數據通道上發送響應信息，使用RRESP[1:0]信號。
* 對於寫事務而言，從設備在寫響應通道上發送響應信息，使用BRESP[1:0]信號。

響應共有四種類型：

* OKAY：一般訪問成功。該信號表示一個一般訪問成功，也表示一個獨佔訪問失敗。
* EXOKAY：獨佔訪問成功。
* SLVERR：從設備錯誤。該信號表示向從設備的訪問已成功，但從設備希望向原始主設備返回一個錯誤條件。
* DECERR：譯碼錯誤。通常由互聯器生成，表示根據給定的事務地址找不到從設備。

RRESP與BRESP的取值如下：

| RRESP/BRESP[1:0] | 響應 |
| :--------------: | :----: |
| 00 | OKAY |
| 01 | EXOKAY |
| 10 | SLVERR |
| 11 | DECERR |

對於寫事務而言，只有當整個突發事務結束時才會發出一個響應。

對於讀事務而言，從設備可以針對突發事務中的每個傳輸發送不同的響應。

協議規定，指定數量的數據傳輸必須全部被執行，即使發生了錯誤。

下面詳細介紹不同的響應所對應的可能的情況：

OKAY響應可能在下列情況出現時產生：

* 一個一般訪問成功。
* 一個獨佔訪問失敗。
* 獨佔訪問指定的從設備不支持獨佔訪問。

EXOKAY響應可能在下列情況出現時產生：

* 一個獨佔訪問成功。

對於SLVERR響應，為了簡化系統監控和調試，規範推薦這種錯誤響應只用於錯誤條件，而不用於除了事件外的一般通知，SLVERR響應可能在下列情況出現時發生：

* FIFO或緩衝區已滿或已空。
* 嘗試不支持的傳輸大小。
* 嘗試寫一個只讀位置。
* 從設備超時。
* 嘗試訪問已禁用或已掉電功能。

對於DECERR響應，只有當互聯器不能找到對應的從設備時才會返回。規範推薦互聯器此時路由到一個默認的從設備，並由該默認從設備返回DECERR響應。

AXI協議要求事務中的全部數據傳輸必須都被完成，即使發生了錯誤，因此任何給定DECERR響應的組件滿足這個需求。

## 事務屬性

### 事務類型和屬性

從設備可以分為以下兩種類型：

* 存儲器從設備：一個需要正確處理全部事務類型的存儲器從設備。
* 外設從設備：一個外設從設備實現了定義的訪問方法。通常，這被記載在組件的datasheet中。對於未定義的訪問方法，外設從設備必須能夠完成事務，但是規範並不要求從設備能夠正確的完成所操作，它之要求從設備能夠繼續處理接下來的事務，這主要是為了避免系統發生死鎖。

AXI協議定義了一整套支持存儲器和外設從設備的事務屬性，使用ARCACHE與AWCACHE信號來表示（後面使用AxCACHE指代這兩個信號），這些信號控制事務通過系統進行的方式與系統級Cache處理事務的方式。

### AXI3存儲器屬性信號

在AXI3中，AxCache[3:0]指定了事務的可Buffer（Bufferable）、可Cache（Cacheable）與分配（Allocate）屬性：

| AxCACHE | 值 | 事務屬性 |
| :-----: | :---: | :-----------------: |
| [0] | 0/1 | 不可Buffer/可Buffer |
| [1] | 0/1 | 不可Cache/可Cache |
| [2] | 0/1 | 不可讀分配/可讀分配 |
| [3] | 0/1 | 不可寫分配/可寫分配 |

可Buffer（B）是指，互聯器或者其它任何組件是否可以讓事務延遲任意個週期到達目的端，通常該屬性僅與寫請求相關。
可Cache（C）是指，傳輸分配是否被允許，以及原始事務特徵是否一定匹配最終的事務特徵，即多次寫事務是否可以被合併（對於寫事務）或某個位置的內容是否可以被預取（對於讀事務）或某個讀操作是否可以被分解為多個讀事務（對於讀事務）。
可讀分配（RA）是指：是否推薦事務進行讀分配，但不是強制的，當不可Cache時，該位必須為0。
可寫分配（WA）是指：是否推薦事務進行寫分配，但不是強制的，當不可Cache時，該位必須為0。

### AXI4對存儲器屬性信號的變更

AXI4做出了如下變更：

* AxCACHE[1]為重命名為可修改（Modifiable）位。
* 對於不可修改事務，定義了傳輸順序要求。
* 更新了讀分配和寫分配的含義。

#### AxCACHE[1]，可修改

在AXI4中，AxCACHE[1]位為可修改位，當該位為高時，表示事務特徵可修改，當改位為低時，表示事務特徵不可修改。

**注意：該位僅僅是被重命名，因為新的名字能更好地描述該位的用途，而實際功能並未改變。**

不可修改事務：

一個不可事務傳輸不能分割為多個事務，也不能和其它事務合併，下表中的參數也不能被改變：

| 參數 | 信號 |
| :------: | :----------------: |
| 傳輸地址 | AxADDR以及AxREGION |
| 突發大小 | AxSIZE |
| 突發長度 | AxLEN |
| 突發類型 | AxBURST |
| 鎖定類型 | AxLOCK |
| 保護類型 | AxPROT |

而AxCache信號僅被允許由可Buffer修改為不可Buffer，不允許其它的修改。

事務ID和QoS可被修改。

一個突發長度超過16的不可修改事務可被分割為多個事務，產生的事務仍然必須滿足上述要求，除了：

* 突發長度減小。
* 突發地址被適當地修改。

對於獨佔的不可修改傳輸，在保持總訪問字節數不變的情況下，允許修改AxSIZE與AxLEN。

注意：

* 存在一些無法滿足不可修改事務需求的情況，例如，傳輸降級到更狹窄的總線時，事務的傳輸大小AxSIZE必須修改。
* 一個組件可以包含自定義的機制來通知事務特徵發生了修改，這有助於軟件調試。

可修改事務：

在可修改事務中，下列特徵可以被修改：

* 一個事務可以被分割為多個事務。
* 多個事務可以被合併為一個事務。
* 一個讀事務可以進行預取操作。
* 一個寫事務可以訪問比所需更大的地址範圍，使用WSTRB信號以確保只有合適的位置被更新。
* 在每個生成的事務中，下列信號可以被修改：傳輸地址、突發大小、突發長度、突發類型。

下列特徵不可以被修改：

* 鎖定類型，AxLOCK。
* 保護類型，AxPROT。

存儲器屬性AxCACHE可以被修改，但是任何修改都必須確保事務的可見性不會因為阻止事務傳播到所需的點或更改在Cache中尋找事務的需求而減少。任何對於存儲器屬性的修改都必須與相同地址範圍內的其它事務一致。

傳輸ID和QoS可被修改。

當修改的結果出現如下情況時是不允許的：

* 導致訪問與原始事務不同的4KB地址空間。
* 導致針對單次拷貝原子大小的區域的單次訪問變為多次訪問操作。

#### 不可修改事務的順序要求

AXI4要求滿足下列全部條件的任何事務集的順序被保證：

* 事務是不可修改的。
* 事務使用了相同的AXI ID。
* 事務目標是相同的從設備。

無論事務的地址是什麼，只要事務目標是同一個從設備，事務順序都必須被保證。

**注意：當讀寫通道上分別出現獨立的事務時，如果一個事務在另一個事務的響應被收到後才發出，則順序可以被保證，否則順序不能被保證。**

#### 讀分配與寫分配的更新含義

在AXI4中，讀分配位表示事務中是否會發生分配，寫分配位表示是否可能由於另一個事務而進行了分配。

對於讀事務，寫分配位被重定義用來表示：

* 由於先前的寫事務，該位置可能已經預先在Cache中分配（就像AXI3所定義的那樣）。
* 由於先前另一個主設備的行為，該位置可能已經預先在Cache中分配（AXI4的附加定義）。

對於寫事務，讀分配位被重定義用來表示：

* 由於先前的讀事務，該位置可能已經預先在Cache中分配（就像AXI3所定義的那樣）。
* 由於先前另一個主設備的行為，該位置可能已經預先在Cache中分配（AXI4的附加定義）。

這樣變更意味著：

* 如果AxCACHE[3:2]不等於00，事務必須在Cache中查找。
* 如果AxCACHE[3:2]等於00，事務不需要在Cache中查找。

新的AWCACHE定義如下：

| 名稱 | AXI4定義 | 描述 |
| :--------: | :------------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| AWCACHE[3] | Allocate | 當該位有效時，事務必須首先在Cache中查找，因為它可能被預先分配，同樣的，如果AWCACHE[2]有效，事務同樣需要預先在Cache中查找。而如果這兩位都為0，事務則不必查找Cache。 |
| AWCACHE[2] | Other Allocate | 當該位有效時，事務必須首先在Cache中查找，因為它可能由於其它的事務，即讀事務或來自另一個主設備的事務，在Cache中被預先分配。 |
| AWCACHE[1] | Modifiable | 當該位有效時，事務的特徵可以修改，寫事務可以被合併 |
| AWCACHE[0] | Bufferable | 當該位無效時，如果AWCACHE[3:2]為00，寫響應必須來自最終目的端。<br />當該位有效時，若AWCACHE[3:2]為00，寫響應可以來自中間點，但寫事務必須及時被最終目的端看到。<br />當該位無效時，如果AWCACHE[3:2]不為00，寫響應可以來自中間點，但寫事務必須及時被最終目的端看到。<br />當該位有效時，如果AWCACHE[3:2]不為00，寫響應可以來自中間點，同時寫傳輸可以不必被最終目的端看到。 |

新的ARCACHE定義如下：

| 名稱 | AXI4定義 | 描述 |
| :--------: | :------------: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ARCACHE[3] | Other Allocate | 當該位有效時，事務必須首先在Cache中查找，因為它可能由於其它的事務，即寫事務或來自另一個主設備的事務，在Cache中被預先分配，同樣的，如果ARCACHE[2]有效，事務同樣需要預先在Cache中查找。 |
| ARCACHE[2] | Allocate | 當該位有效時，事務必須首先在Cache中查找，因為它可能被預先分配。 |
| ARCACHE[1] | Modifiable | 當該位有效時，事務的特徵可以修改，寫事務可以被合併。 |
| ARCACHE[0] | Bufferable | 當ARCACHE[3:1]為000時該位無用。<br />當ARCACHE[3:2]為00且ARCACHE[1]為1時，若該位無效，則讀取的數據必須來自最終目的端，否則可以來自一個指向該目的端正在處理的寫事務。<br />當ARCACHE[3]有效或ARCACHE[2]有效時，該位可以用來區分寫穿和寫回存儲器類型。 |

### 存儲器類型

下列的表中給出了AxCACHE的編碼含義，其中有的類型擁有兩種編碼，其中括號內的是AXI3所採用的編碼，其它則為AXI4所採用的編碼，這主要是為了讓AXI4具有向下兼容能力：

| ARCACHE[3:0] | AWCACHE[3:0] | 存儲器類型 |
| :----------: | :----------: | :---------------------------: |
| 0000 | 0000 | 不可Buffer設備 |
| 0001 | 0001 | 可Buffer設備 |
| 0010 | 0010 | 一般不可Cache不可Buffer存儲器 |
| 0011 | 0011 | 一般不可Cache可Buffer存儲器 |
| 1010 | 0110 | 寫穿不可分配存儲器 |
| 1110(0110) | 0110 | 寫穿可讀分配存儲器 |
| 1010 | 1110(1010) | 寫穿可寫分配存儲器 |
| 1110 | 1110 | 寫穿可讀寫分配存儲器 |
| 1011 | 0111 | 寫回不可分配存儲器 |
| 1111(0111) | 0111 | 寫回可讀分配存儲器 |
| 1011 | 1111(1011) | 寫回可寫分配存儲器 |
| 1111 | 1111 | 寫回可讀寫分配存儲器 |

### 不同的存储器属性

访问存储器相同区域的多个代理可以使用不同的内存属性，然而，为保证功能正确性，必须遵守如下几条规则：

* 所有访问存储器相同区域的主设备都必须拥有该区域的一致性可Cache视图，也就是说，要么这些主设备的AxCACHE[3:2]均为00，或均为非00。
* 不同的主设备可以使用不同的可分配暗示信号。
* 如果一个寻址区域是一般不可Cache的，任何主设备都可以使用设备存储器事务方式访问。
* 如果一个寻址区域是可Buffer的，任何主设备都可以使用不可Buffer的方式访问。

#### 改变存储器属性

一个特定存储器区域的属性可以被改变，不过这需要一个合适的流程来执行，通常如下所示：

1. 所有的主设备停止访问该区域。
2. 某个主设备执行Cache维护操作。
3. 所有的主设备使用新属性重启对该区域的访问。

### 访问权限

AXI提供了访问权限信号用以阻止非法事务：

* ARPROT[2:0]定义了读访问的访问权限。
* AWPROT[2:0]定义了写访问的访问权限。

其中，信号定义如下：

| AxPROT |  值   |        功能         |
| :----: | :---: | :-----------------: |
|  [0]   |  0/1  | 非特权访问/特权访问 |
|  [1]   |  0/1  | 安全访问/不安全访问 |
|  [2]   |  0/1  |  数据访问/指令访问  |

#### 非特权与特权访问

一些处理器支持多种特权级，但是AXI仅支持两种特权级，具体的映射方法可以参照具体处理器的文档。

#### 安全与非安全访问

该定义与ARM安全扩展中所定义的一致。


#### 指令与数据

在AXI协议规范中，该位仅仅是一种暗示，例如，若某个事务包含指令和数据的混合项，则推荐将该位设置为0，表示当前进行的是数据访问而不是指令访问。

### 遗留问题

AXI4在处理一些AxCACHE存储器属性时引入了额外的要求。

在AXI4中，所有使用相同ID且目的从设备相同的设备事务都必须按序排列。

注意：

* 这并不是AXI3的要求，任何依赖该行为的AXI4组件都不能连接到不支持该特性的AXI3互联器上。
* ARM相信大多数的AXI3互联器都支持所需的AXI4行为。

该规范强烈推荐任何新的AXI3设计都应该实现AXI4的要求。

对于AxCACHE位名和存储器类型名，AX3组件可以使用AXI3或AXI4的名字。

## 多事务

### AXI事务标识符

AXI协议包含AXI ID事务标识符，主设备可以使用这个区分需要按序返回的事务。

AXI ID相同的事务必须保证顺序，但是AXI ID不同的事物则不能保证顺序，这意味着单个物理端口可以支持乱序事务，并据此模拟出多个逻辑端口，其中每个端口都是按序端口。

使用AXI ID，主设备可以在前面事务未完成的时候就发送新的事务，这可以提升系统效率，因为这允许事务的并行处理。

**注意：这并没有要求主设备和从设备一定使用AXI事务ID，主设备和从设备可以同时只处理一个事务，这意味着所有的事务都是按序的，同时从设备返回的BID和RID必须和主设备发出的AXI ID一致。**

### 事务ID

每一个事务通道都拥有自己的事务ID，如下表所示：

|      事务通道      | 事务ID |
| :----------------: | :----: |
|     写地址通道     |  AWID  |
| 写数据通道，仅AXI3 |  WID   |
|     写响应通道     |  BID   |
|     读地址通道     |  ARID  |
|     读数据通道     |  RID   |

**注意：AXI4协议支持基于AXI ID的扩展顺序模型。**

### 事务顺序

主设备可以使用AWID和ARID事务ID信号来表明它的顺序要求，具体情况如下：

* 来自不同主设备的事务是不需按序的。
* 来自相同主设备但ID不同的事务是不需按序的。
* 具有相同ARID的一系列读事务的数据传输必须按照主设备发出地址的顺序返回。
* 具有相同AWID的一系列写事务的数据传输必须按照主设备发出地址的顺序返回。
* 在AWID与ARID使用相同值的读写事务之间是不需按序的。

**注意：AXI3因为支持写数据交错，因此写数据通道中才含有WID信号，而在AXI4中，写数据的顺序必须和写地址的顺序一致，因此WID信号被移除。**

#### 事务ID信号的宽度

事务ID信号的宽度可以任意定义，然而，规范推荐下列事务ID信号宽度：

* 主设备实现至多4bit的事务ID。
* 互联器增加额外的至多4bit的事务ID用于支持多主端口。
* 从设备实现8bit的事物ID信号支持。

对于只支持单个按序接口的主设备，将事务ID信号置为一个常量，例如0，是可以接受的。

对于不使用顺序信息而将所有事务按序处理的从设备而言，事务ID信号可以在不改变从设备功能的情况下被加入。

#### 遗留问题

大多数AXI3主设备不支持写交错，因此为了满足AXI4的要求不需要做任何改动，而支持写交错的AXI主设备必须要支持写交错深度的配置方法，通过将写交错深度设置为1来兼容AXI4。

**注意：任何需要WID信号的AXI3的组件都可以从AWID信号生成WID信号。**

## AXI4顺序模型

### 顺序模型的定义

AXI4协议支持基于AXI ID事务标识符的顺序模型。

对于相同ID的事务来说：

* 到任何单个外设的事务顺序必然与事务被发出的顺序一致。
* 使用相同或重叠地址的存储器事务的到达顺序必然与事务被发出的顺序一致。

**注意：在拥有多个主设备的AXI系统中，AXI ID中包含主设备的标识符，这意味着对于顺序模型对于每个主设备而言是独立的。**

AXI顺序模型同时要求所有相同方向且AXI ID一致的事务的响应顺序必须与事务发出顺序一致。

因为读地址和写地址通道是独立的，如果需要让不同方向具有相同ID的事务有顺序关系，主设备就必须在发出第二个事务之前等待接收第一个事务的响应，否则是没有顺序保证的，注意在这种情况下，主设备必须要保证收到的响应来自一个合适的点，一个来自中间AXI组件（如互联器）的响应不能保证组件Buffer下游的组件收到事务的顺序。

### 主设备顺序

一个在相同方向发送携带有相同ID的事务时可以得到如下的顺序保证：

* 事务的响应顺序与发出顺序一致。
* 对于到设备存储器的事务，事务到达从设备的顺序必然与发出顺序一致。
* 对于一般存储器，当事务的地址相同或有重叠时，到达的顺序必然与发出顺序一致，这同样针对于可Cache的存储器，即应用于所有AxCACHE[3:1]不为全0的存储器。

所谓事务的地址相同或有重叠，指的是事务在相同的单拷贝原子地址范围内至少有一个字节发生重叠。

### 互联器顺序

为了满足顺序模型的要求，互联器必须保证以下几点：

* 具有相同ID相同方向的、发向设备存储器的事务顺序要保证。
* 具有相同ID相同方向的、相同或重叠地址的事务顺序要保证。
* 相同ID事务的写响应顺序要保证。
* 相同ID事务的读响应顺序要保证。
* 任何对AXI ID值的操作都必须保证新的事务依然保持相同的顺序。
* 在事务到达其最终目的地之前，任何提供响应的组件都必须确保在事务到达其目的端之前都要维护本节给出的顺序要求。

### 从设备顺序

为了满足顺序模型的要求，从设备必须保证以下几点：

* 任何已经发出响应的写事务都必须能被任何后续的读或写事务所观察到，无论其事务ID是什么。
* 在相同事务ID的情况下，任何针对于设备存储器的写事务都必须能够被任何后续针对设备存储器的写事务观察到，无论响应是否发出。
* 在相同ID的情况下，任何针对一般存储器的写事务都必须能被后续针对相同或重叠地址的写事务观察到，无论响应是否发出，这同样也适用于可Cache存储器，即AWCACHE[3:1]不为0的存储器。
* 针对相同ID的多个写事务的响应的发送顺序必须与事务的到达顺序一致。
* 针对不同ID的多个写事务的响应的发送顺序可以是任意的。
* 任何已经发出响应的读事务都必须能够被任何后续的读或写事务所观察到，无论其事务ID是什么。
* 在相同事务ID的情况下，任何针对于设备存储器的读事务都必须能够被任何后续针对设备存储器的读事务观察到，无论响应是否发出。
* 针对相同ID的多个读事务的响应的发送顺序必须与事务的到达顺序一致。
* 针对不同ID的多个读事务的响应的发送顺序可以是任意的。

### 在目的端之前发出响应

任何中间组件都可以在事务到达目的端之前发出响应，但必须确保，对于任何其它来自上游主设备的事务而言，该事务的可见性。

当访问全部类型的存储器时，任何针对相同或重叠地址的新事务都必须能够观察到中间组件发出响应对应的事务。

当访问设备存储器时，中间组件必须维护任何具有相同ID以及到相同从设备的事务的顺序。

只有当事务的AxCACHE属性表明中间组件可以直接发出响应时，中间组件才可以发出响应。

AXI协议要求，针对设备存储器的访问顺序保证是针对一般存储器的访问顺序保证的超集，这意味着当任何标记为一般存储器访问类型的事务被转换为设备存储器访问类型时不需要移除任何原先的顺序保证，为了满足这个要求，针对相同或重叠地址的设备存储器的访问行为必须与一般存储器访问行为一致，无论其ID是什么。

下表给出了不同存储器类型在ID是否相同、地址是否重叠不同组合下的顺序要求。

| 存储器类型 | ID是否相同 | 地址是否重叠 | 是否要求顺序 |
| :--------: | :--------: | :----------: | :----------: |
| 设备存储器 |     是     |      是      |      是      |
| 设备存储器 |     是     |      否      |      是      |
| 设备存储器 |     否     |      是      |      是      |
| 设备存储器 |     否     |      否      |      否      |
| 一般存储器 |     是     |      是      |      是      |
| 一般存储器 |     是     |      否      |      否      |
| 一般存储器 |     否     |      是      |      是      |
| 一般存储器 |     否     |      否      |      否      |

这里说的一般存储器，同样适用于可Cache存储器，即AxCACHE[3:1]不为全0的存储器。

### 观察顺序

为了提升接口对不同顺序模型接口协议的兼容性，规范提供了Ordered_Write_Observation属性，该属性可针对单个接口设置为True或False，如果该属性设置为True，说明该端口拥有该属性，否则说明该接口不支持该属性。

一个支持Ordered_Write_Observation属性的接口可以支持生产者/消费者顺序模型以提升效率。

如果两个拥有相同ID的写事务可以被系统中的其它代理以与事务发出顺序相同的顺序观察到事务，则该接口可以声称其提供了Ordered_Write_Observation支持。

如果一个接口不支持Ordered_Write_Observation特性，则仅能保证针对相同ID到相同外设的写事务顺序。为了在这种情况下支持生产者/消费者顺序模型，在后续针对不同外设的写事务发出前，必须通过BRESP等待接收前一个写事务的响应。

## 原子访问

### 单拷贝原子大小

AXI4协议引入了单拷贝原子大小的概念，这个术语定义了一个事务原子更新的最小字节数。AXI4协议要求大于一个单拷贝原子大小的事务必须更新至少为单拷贝原子大小的内存块。

**注意：原子性并不定义数据更新的确切时刻。必须确保的是，没有一个主设备可以观察到原子数据的部分更新形式。例如，在使用许多系统数据结构例如由32bit原子元素构成的链表时，针对这些元素的原子更新操作必须同时更新整个32bit的值，任何一个主设备在某个时刻只观测到其中的16bit发生更新，而在另一个时刻观测到另外16bit发生更新的的这一行为是不可接受的。**

更复杂的系统要求支持更大的原子元素，特别是64bit原子元素，以便主设备可以使用基于更大原子元素的数据结构通信。

系统所支持的单拷贝原子大小非常重要，因为给定通信中设计的所有组件都必须支持苏偶像的原子元素大小。如果两个主设备正在通过互联器和同一个从设备通信，则所有涉及到的组件都必须确保所需大小的事务被原子对待。

AXI4协议不要求特定的单拷贝原子大小，系统可以支持不同的单拷贝原子大小。

对于组内通信，不同的组件组可以拥有不同的单拷贝原子大小，在AXI4中，单拷贝原子组这一术语指的是一组可以以特定的原子性进行通信的组件。

下图展示了如下的一个系统：

* 处理器、DSP、DRAM控制器、DMA控制器、外设、SRAM以及关联的互联器都在一个32bit的单拷贝原子组中。
* 处理器、DSP、DRAM控制器以及关联的互联器也在一个64bit的单拷贝原子组中。

![avatar](pic/11.png)

事务的原子性只有在它的起始地址正确对齐时才能得到保证，例如，对于一个64bit的单拷贝原子组来说，如果突发事务的地址没有对齐到8字节边界，那么该事务就没有任何64bit单拷贝原子保证。

事务的字节选通信号不会影响单拷贝原子大小。

#### 多拷贝写原子性

要指定一个系统提供多拷贝原子性，必须定义Multi_Copy_Atomicity属性。

如果这个属性被设置为True，则该系统拥有这个能力，否则该系统不拥有这个能力。

如果以下条件满足，则可以说明一个系统具有多拷贝原子性：

* 针对同一个位置的写操作可以被所有的代理以相同的顺序观察到。
* 对于一个除发出者外的代理可以观测到的写操作而言，其它的代理也都能观测到。

多拷贝原子性可以通过如下手段来保证：

* 对于一个给定的地址使用单点序列化（POS），这样针对相同位置的全部访问操作都可以按序处理器，必须确保在该位置的新值针对任何代理都可见之前将被Cache的一致性拷贝全部无效化。
* 避免在代理的上游使用前向Buffer，这可以避免一个Buffer写操作在对全部代理可见前对某些代理可见。

**注意：如果一个系统使用了ARM v8架构处理器，则该系统必须拥有Multi_Copy_Atomicity属性。该属性用来支持获取加载和释放存储指令，释放存储指令要求存储操作是多拷贝原子性的。**

### 独占访问

独占访问机制提供了信号量类型的操作，利用该机制时，不需要在整个访问周期内让总线被一个主设备所独占，这意味着信号量类型操作不会影响总线访问延迟以及最大可实现带宽。

AxLOCK信号选择独占访问，RRESP和BRESP信号则分别表示独占读和独占写操作的成功与否。

从设备要求额外的逻辑实现独占访问，当主设备访问一个不支持独占访问的从设备时，AXI协议提供了一种机制用来通知该主设备其所访问的从设备不支持独占访问操作。

#### 独占访问过程

独占访问的基本机制如下：

1. 主设备在给定地址上执行独占读事务。
2. 过一段时间后，主设备尝试在相同的地址上执行独占写事务，这会导致独占读事务的完成，同时，独占写事务的AWID与独占读事务的ARID相同。
3. 如果从执行独占读事务开始没有其它主设备写相同的位置，独占写事务将会更新存储器，并返回成功信号，否则会返回失败信号。

主设备或许不会完成独占事务的写部分，独占访问监视硬件对于每一个事务ID只会监视一个地址。如果一个主设备没有完成独占事务的写部分，接下来这个主设备又以相同的事务ID对另一个地址发起了独占读事务，则独占访问监视的地址就会被改变。

#### 从主设备视角看待独占访问

一个主设备通过执行一个独占读事务的方式开始一个独占操作，如果事务成功，从设备就会返回EXOKAY响应，表示从设备已经记录了要监视的地址。

如果主设备尝试向不支持独占访问的从设备发出独占读事务请求，从设备会返回OKAY响应而不是EXOKAY响应。

**注意：主设备可以将OKAY响应作为独占访问不支持的错误响应看待，规范推荐主设备接下来不要执行独占操作的写部分。**

在独占读操作之后的一段时间后，主设备尝试对相同位置发起独占写事务，如果从独占读事务开始时到现在对应地址的内容始终没有发生改变，独占写操作就会成功，从设备返回EXOKAY响应，并更新对应的存储器位置，否则，独占写操作就会失败，从设备返回OKAY响应而不是EXOKAY响应，独占写操作不会更新对应的存储器位置。

主设备或许不会完成独占操作的写部分，如果发生了这种情况，从设备将会继续监视独占访问的地址直到针对该从设备的另一个独占读事务启动一个新的独占访问序列。

主设备在独占访问序列的读部分完成后才会开始独占访问序列的写部分。

#### 从从设备视角看待独占访问

不支持独占访问的从设备可以忽略AxLOCK信号，这样的从设备对于一般和独占访问都必须提供OKAY响应信号。

支持独占访问的从设备必须拥有监视硬件，规范推荐对于每一个支持独占的事务ID而言都准备一个监视单元。ARM规范参考手册，ARMv7-A和ARMv7-R版本定义了一种独占访问监视器，一个单端口的从设备可以拥有一个外接的独占访问监视器，而一个多端口的从设备则或许需要实现内部监视器。

独占访问监视器需要记录任何独占读操作的地址和ARID，然后需要监视指定的位置，直到针对该位置的写操作发生或者使用相同ARID的另一个独占读操作复位监视器并将地址设置为另一个值。

当从设备接收到一个独占写事务时，监视器就会根据给定的AWID检查指定的地址是否被监视，如果是，这表示从独占读操作开始以来没有发生写操作，然后就会处理写操作并完成整个独占访问过程，返回EXOKAY响应，并更新存储器。

如果在进行独占写时，地址不再被相同AWID的监视硬件监视，则表明发生了下列情况之一：

* 在独占读访问事务发起之后，对应的位置的内容被更新。
* 监视器的地址被另一个独占读事务重置修改。

在以上两种情况中，独占写事务都不会更新对应的存储器位置，从设备必须返回OKAY而不是EXOKAY响应。

#### 独占访问限制

独占访问存在以下限制：

* 独占写操作的突发大小和突发长度必须与其对应的独占读操作一致。
* 独占访问的地址必须对齐到事务的总字节数，也就是突发大小与突发长度的乘积。
* 独占读与独占写事务的地址必须一致。
* 独占读事务的ARID必须与独占写事务的AWID一致。
* 独占读和独占写事务的控制信号必须一致。
* 独占访问突发传输的字节数必须是2的幂，即1、2、4、8、16、32、64或128字节。
* 独占访问突发传输的最大字节数为128字节。
* 在AXI4中，独占访问的突发长度不能超过16。
* AxCACHE信号的值必须保证监视独占访问的从设备可以看到事务。例如，独占访问事务的AxCACHE的值一定不表示事务是可Cache的。

不遵守这些限制将会导致**不可预测**的结果。

在独占操作过程中监视的最小字节数由事务的突发长度和突发大小所定义，而从设备可以选择监视更大的字节数（最大不超过128字节），但当相邻的字节被更新时，这会导致本应成功的独占访问操作变为失败状态。

#### 不支持独占访问的从设备

RRESP与BRESP响应信号在表示一般访问成功时使用OKAY信号，而在表示独占访问成功时使用EXOKAY信号，这意味着不支持独占访问的从设备会使用OKAY信号表示独占访问操作的失败。

注意：

* 针对不支持独占访问从设备的独占写操作总会更新存储器。
* 针对支持独占访问从设备的独占写操作只有在独占写操作成功时才会更新存储器。

### 锁定访问

AXI4不支持锁定事务，而AXI3实现则必须支持锁定事务。

AXI4由于以下原因移除了锁定事务的支持：

* 大多数组件不需要锁定事务。
* 锁定事务的实现会对互联器的复杂度以及QoS保证能力造成显著的影响。

当主设备使用AxLOCK信号表示当前事务是一个锁定事务时，互联器就必须确保只有当前主设备可以访问目标从设备区域，直到该主设备发出解锁事务为止，互联器的仲裁器必须强制执行此限制。

在主设备开始读事务或写事务的锁定序列前，该主设备必须确保没有其它等待完成的事务。

任何携带AxLOCK信号的事务都是锁定事务，这会强制互联器锁定接下来的事务，因此，一个锁定序列只有当主设备发出无AxLOCK信号事务时才会终止，这个终止事务包含在锁定序列中并实际上移除了锁。

在即将完成锁定序列时，必须首先确保所有的锁定事务都已经完成，然后才能发出终止解锁事务，并必须确保在进行接下来的任何事务之前该解锁事务已经执行完成。

主设备必须确保一个锁定序列中的全部事务都拥有相同的AxID值。

**注意：锁定访问事务需要互联器在锁定序列进行中时避免任何其它的事务发生，这会对互联器的效率产生影响，因此，该规范推荐锁定访问事务只用于支持早期设备。**

该规范推荐下列的限制（但不是强制性的）：

* 在单个4KB地址域内保持任何锁定事务序列。
* 将任何锁定任务序列限制为两个事务。

### 原子访问信号

在AXI3中，AxLOCK信号用于指定一般、独占和锁定访问，下表为AXI3规范对于AxLOCK信号的编码：

| AxLOCK[1:0] | 访问类型 |
| :---------: | :------: |
|     00      | 一般访问 |
|     01      | 独占访问 |
|     10      | 锁定访问 |
|     11      |   保留   |

AXI4移除了锁定事务，仅使用1bit锁定信号，下表为AXI4规范对于AxLOCK信号的编码：

| AxLOCK | 访问类型 |
| :----: | :------: |
|   0    | 一般访问 |
|   1    | 独占访问 |

#### 遗留问题

在AXI4环境中，任何AXI3锁定事务可以按照下列方式被转换：

* AWLOCK[1:0] = 10被转换为一般写事务，AWLOCK = 0。
* ARLOCK[1:0] = 10被转换为一般读事务，ARLOCK = 0。

该规范推荐任何组件执行这样的转换，一般是互联器，可以包含一个可选的机制用于检测和标记这样的事务发生。

如果某些组件执行了这样的转换后不能正确工作，则这样的组件不能在AXI4环境中使用。

**注意：对于许多早期使用锁定事务的例子，例如SWP指令的执行，或许需要通过修改软件的方式来避免使用强制使用锁定事务的指令。**

## AXI4附加信号

### QoS信号

#### QoS接口信号

AXI4信号集支持两个4bit的QoS标识符：

* AWQOS：一个4bit的QoS标识符，在每次写事务中由写地址通道发送。
* ARQOS：一个4bit的QoS标识符，在每次读事务中由读地址通道发送。

协议并没有指定QoS标识符的精确使用方法，规范推荐AxQOS的值用于优先级指示器，更大的值表示更高优先级的事务。

当使用默认值0000时表示接口不参与任何QoS方案。

#### 主设备问题

一个主设备可以产生自己的AxQOS值，如果它可以产生多个传输流，则可以为这些流分配不同的QoS值。

为了支持QoS，需要对正在使用的QoS方案有系统级的理解，同时需要全部的组件之间互相配合，因此，规范推荐主设备组件支持精确控制QoS值的机制用于任何给定的场景。

如果主设备组件不支持任何可编程的QoS方案，则它可以使用QoS值代表事务的相对优先级，然后可以将这些值映射到备用的系统级QoS值。

不能产生AxQOS值的主设备必须使用默认值。

**注意：规范期望一些互联组件实现一些可编程寄存器，这些寄存器可以用于分配QoS值到连接的主设备，覆盖掉主设备原先的QoS值。**

#### 系统问题

AXI4中定义的QoS信号可以用于任何兼容的系统级QoS方法。

QoS默认的系统级实现是，任何组件可以选择处理多个事务时，都会选择QoS值较高的事务优先处理。这个选择仅当没有其他要求事务需要按特定顺序处理的约束时才会发生。

**注意：这意味着AXI顺序规则优先于QoS。**

可以实现兼容默认方案的更复杂的QoS方案。

### 多区域信号

#### 附加接口信号

AXI4接口信号集支持两个4bit区域标识符（可选）：

* AWREGION：一个区域标识符，在每次写事务中由写地址通道发送。
* ARREGION：一个区域标识符，在每次读事务中由读地址通道发送。

4bit区域标识符可以用于唯一地标识16个不同的区域，区域标识符可以提供更高阶的地址位译码，但在任何4KB地址空间内必须保持不变。

区域标识符的使用意味着从设备的单个物理接口可以提供多个逻辑接口，每一个都位于系统地址映射中的不同位置，区域标识符的使用也意味着从舍尔必不支持不同逻辑接口间的地址译码。

这个协议期望互联器在为拥有多个逻辑接口的单个从设备执行地址译码功能时产生AxREGION信号，如果一个从设备在系统地址映射中只有一个物理接口，则互联器必须使用默认的AxREGION值。

从设备必须确保两个位于不同区域但拥有相同的AXI ID的事务以正确地顺序响应。

如果从设备实现的区域少于16个时，从设备必须确保在任何主设备尝试访问不支持的区域时给出正确的协议信号，而这需要具体实现自行定义，例如，从设备或许需要通过下列方式来确保上述事宜：

* 对于任何访问不支持区域的事务提供一个错误响应。
* 为所有不支持的区域分配支持区域的别名，以确保响应符合协议。

AxREGION信号仅提供了对从设备可使用的现存地址空间的地址译码功能，以消除对地址译码功能的需求，这个信号并没有创建新的独立地址空间。

AxREGION只能出现在地址译码功能的下游接口上。

### 用户定义信号

AXI4接口信号集在每个通道上包含了一些用户定义信号，一般情况下，规范推荐用户不使用用户信号，因为AXI协议并没有定义这些信号的功能，贸然使用可能会导致两个组件之间出现互操作性的问题，因为两个组件可能以不兼容的方法使用了相同的用户信号。

#### 信号命名

每个AXI4通道定义的用户信号名称如下：

* AWUSER：写地址通道用户信号。
* ARUSER：读地址通道用户信号。
* WUSER：写数据通道用户信号。
* RUSER：读数据通道用户信号。
* BUSER：写响应通道用户信号。

#### 使用问题

协议并不要求所有通道都支持用户信号。

规范推荐互联器包含用户信号，然而，并没有要求主设备和从设备包含用户信号。

规范推荐互联组件包含用户信号的支持，以便互联组件可以将用户信号在主设备和从设备之间传送，用户定义信号的宽度是具体实现定义的，对于每个通道都可以是不同的。

## 低功耗接口

### 关于低功耗接口

低功耗接口是AXI协议的可选扩展，以如下两类外设为目标：

* 任何没有下电序列且可以指示其时钟何时被关闭的外设。
* 任何要求下电序列，且只有在进入低功耗状态后才能停止时钟的外设，这样的外设要求系统时钟控制器指示其何时开始下电序列，并且外设在进入低功耗状态后必须发出通知信号。

### 低功耗时钟控制

低功耗时钟控制接口包含如下信号：

* 一个来自外设的信号用于指示其时钟何时可以被开启关闭。
* 两个为系统时钟控制器准备的握手信号用于请求进入或退出低功耗状态。

#### 外设时钟要求

CACTIVE信号表示外设是否需要时钟信号，当外设需要时钟使能的时候就会拉高CACTIVE信号，此时系统时钟控制器就必须立即使能时钟。当外设不需要时钟的时候就会拉低CACTIVE信号，系统时钟控制器可以关闭该时钟，但也可以不关闭。

如果一个外设在任何时候都允许其时钟被使能或禁用，则可以永久性地拉低CATIVE信号，若一个外设要求其时钟永久使能，则必须永久性地拉高CACTIVE信号。

CACTIVE仅用于没有下电或上电序列支持的某些外设的时钟控制。

#### 下电或上电握手

对于一个拥有下电或上电序列的外设而言，只有在系统时钟控制器发出请求之后外设才会进入低功耗状态，AXI协议提供了请求/响应握手信号用于支持这个功能：

* CSYSREQ：系统时钟控制器使用CSYSREQ信号请求外设进入低功耗状态（拉低CSYSREQ信号）或退出低功耗状态（拉高CSYSREQ信号）。
* CSYSACK：外设使用CSYSACK信号通知系统时钟控制器已完成请求，对于进入低功耗状态请求，外设会拉低CSYSACK信号，对于退出低功耗状态请求，外设会拉高CSYSACK信号。

下列是这CSYSREQ与CSYSACK信号的时序图：

![avatar](pic/12.png)

在序列开始时，CSYSREQ与CSYSACK信号都为高电平，在T1时刻，系统时钟控制器拉低CSYSREQ表示请求外设进入低功耗状态，外设在T2时刻拉低CSYSACK信号响应请求，在T3时刻，系统时钟控制器拉高CSYSREQ信号请求外设退出低功耗状态，在T4时刻，外设拉高CSYSACK信号响应请求。

外设可以同意或拒绝系统时钟控制器进入低功耗状态的请求，在外设响应请求的时候通过将CACTIVE信号拉高或拉低来表示接受或拒绝请求。

#### 接受低功耗请求

下图是外设接受系统低功耗请求时的时序图：

![avatar](pic/13.png)

在T1时刻，系统时钟控制器拉低CSYSREQ信号以请求外设进入低功耗状态，在外设识别到这个请求后，执行了自己的下电序列，并在T2时刻拉低了CACTIVE信号用来表示时钟信号可以被移除。在T3时刻，外设拉低CSYSACK信号通知系统时钟控制器该外设已进入低功耗模式，

外设只有在拉低CACTIVE至少一个时钟之后才能拉低CSYSACK信号。

#### 拒绝低功耗请求

下图是外设拒绝系统低功耗请求时的时序图：

![avatar](pic/14.png)

在T1时刻，系统时钟控制器拉低CSYSREQ信号以请求外设进入低功耗状态，在T2时刻外设响应该请求，但此时仅拉低了CSYSACK信号而并没有拉低CACTIVE信号，因此系统时钟控制器必须维持时钟，并且在执行了低功耗状态退出序列后才能发起另一个低功耗请求。在T3时刻，系统时钟控制器通过拉高CSYSREQ开始了低功耗状态退出序列，在T4时刻，外设拉高CSYSACK表示完成了低功耗状态退出序列。

#### 退出低功耗状态

无论是系统时钟控制器还是外设都可以请求退出低功耗状态，外设要求CACTIVE与CSYSREQ信号在整个低功耗状态期间保持为低电平，这两个信号之一变为高电平都会触发低功耗状态退出序列的启动。

系统时钟控制器触发退出序列：

![avatar](pic/15.png)

在T1时刻，系统时钟控制器拉高CSYSREQ信号以请求退出低功耗状态，然后使能时钟，外设识别到CSYSREQ信号为高电平后开始执行其自身的上电序列，并在T2时刻拉高CACTIVE信号表示它需要时钟信号，然后外设在T3时刻拉高CSYSACK完成退出序列。

外设触发退出序列：

![avatar](pic/16.png)

在T1时刻外设拉高CACTIVE信号以通知其需要时钟信号，然后系统时钟控制器必须恢复时钟。

在T2时刻系统时钟控制器拉高CSYSREQ信号以便继续握手序列，外设接下来会拉高CSYSACK信号以完成退出序列。

**注意：外设可以让CSYSACK保持数个周期的低电平以完成自身的退出序列。**

#### 组合低功耗域中的外设

系统时钟控制器可以组合一些不同的外设到一个相同的低功耗时钟域中，它可以将时钟域看作一个单独的外设，但要求下列规则必须遵守：

* 时钟域的CACTIVE信号是时钟域中所有外设CACTIVE信号的逻辑或，这意味着系统时钟控制器只有当所有外设都表示其时钟可以被关闭时才可以关闭时钟。
* 系统控制器必须使用单个CSYSREQ信号路由到时钟域中的全部外设。
* 时钟域CSYSACK信号通过下述方法生成：只有当时钟域中的最后一个外设拉低CSYSACK信号时才会拉低总的CSYSACK信号，只有当时钟域中的最后一个外设拉高CSYSACK信号时才会拉高总的CSYSACK信号。

## 默认信号和互操作性

AXI协议并不要求一个组件使用AXI接口的完整可用信号集。

### 互操作性原则

下列互操作性原则针对AXI3和AXI4组件。

作为一个一般性原则，组件必须支持全部的输入组合，但不必生成全部的输出组合，例如，从设备必须支持不同可能突发长度，但主设备可以只生成它所用的突发类型，这个策略保证全部的组件都能配合其它的组件工作。

AXI接口可以省略信号的条件如下：

* 可选输出：如果一个组件所需的值不与默认值匹配，组件就必须拥有其对应的输出信号，如果一个组件总是需要默认值，则不需要组件存在实际的信号。
* 可选输入：如果一个信号不需要被主设备或从设备观测也能让功能操作正确执行，则该输入信号是可以忽略的。

**注意：互联组件在合适的时候也可以忽略信号，例如，当一个信号仅输出默认值，则该信号就不需要被互联器转发，该信号可以直接在其目的端生成，类似地，如果一个信号不被任何目的端所使用，那么就不需要互联器转发该信号。**

### 主要接口类别

#### 读写接口

读写接口包含下列AXI通道：

* AR：读地址通道。
* R：读数据通道。
* AW：写地址通道。
* W：写数据通道。
* B：写响应通道。

#### 只读接口

只读接口仅支持读事务，因此只包含下述通道：

* AR：读地址通道。
* R：读数据通道。

**注意：只读接口不支持独占访问。**

#### 只写接口

只写接口仅支持写事务，因此只包含下述通道：

* AW：写地址通道。
* W：写数据通道。
* B：写响应通道。

**注意：只写接口不支持独占访问。**

#### 存储器从设备和外设从设备

AXI从设备分为存储器从设备与外设从设备。

存储器从设备必须正确地处理全部事务类型。

规范期望外设从设备拥有一个定义的访问方法，该方法建立了可以用于访问设备的事务类型以及对设备访问方式的限制。通常，定义的访问方法在组件的datasheet中描述，任何未定义的访问方法或许都会造成外设从设备失败，但规范期望以协议兼容的失败-安全方法完成访问以避免系统死锁，但不要求外设从设备继续进行正确的操作。

因为只有当使用外设定义的访问方法时才要求外设正常工作，因此外设从设备可以拥有接口信号的极小子集。

**注意：规范期望所有外设都支持C语言定义的访问方法，如8bit/16bit/32bit对齐访问事务。并不存在要求支持的最小子集，因为每个组件支持的事务子集都可以不同，例如，一个外设可能只支持16bit访问事务，但另一个外设只支持32bit访问事务。**

### 默认信号值

规范建议，一般而言，为了最大限度地重用IP，一个AXI组件接口包含所有的信号，这样就降低了设计流程中系统集成阶段出现错误的风险，它还可以帮助一些不能有效支持缺少信号的默认值的设计流程。

下列的几个表展示了AXI强制和可选信号，同时给出了可选信号的默认值。

主接口写通道信号和默认值：

|   信号   |     描述     | 方向  | 是否强制 |    默认值     |
| :------: | :----------: | :---: | :------: | :-----------: |
|   ACLK   |   公共时钟   | 输入  |   强制   |       -       |
| ARESETn  |   公共复位   | 输入  |   强制   |       -       |
|   AWID   |   写地址ID   | 输出  |   可选   |      全0      |
|  AWADDR  |    写地址    | 输出  |   强制   |       -       |
| AWREGION |    写区域    | 输出  |   可选   |      全0      |
|  AWLEN   |   突发长度   | 输出  |   可选   |  全0，长度1   |
|  AWSIZE  |   突发大小   | 输出  |   可选   | 数据总线宽度  |
| AWBURST  |   突发类型   | 输出  |   可选   | 01，递增模式  |
|  AWLOCK  |   锁定类型   | 输出  |   可选   | 全0，一般访问 |
| AWCACHE  |  Cache类型   | 输出  |   可选   |     0000      |
|  AWPROT  |   保护类型   | 输出  |   强制   |       -       |
|  AWQOS   |    QoS值     | 输出  |   可选   |     0000      |
| AWVALID  |  写地址有效  | 输出  |   强制   |       -       |
| AWREADY  | 写地址准备好 | 输入  |   强制   |       -       |
|  WDATA   |    写数据    | 输出  |   强制   |       -       |
|  WSTRB   |  写字节使能  | 输出  |   可选   |      全0      |
|  WLAST   |    写最后    | 输出  |   强制   |       -       |
|  WVALID  |    写有效    | 输出  |   强制   |       -       |
|  WREADY  |   写准备好   | 输入  |   强制   |       -       |
|   BID    |    响应ID    | 输入  |   可选   |       -       |
|  BRESP   |    写响应    | 输入  |   可选   |       -       |
|  BVALID  |  写响应有效  | 输入  |   强制   |       -       |
|  BREADY  |  响应准备好  | 输出  |   强制   |       -       |

存储器从接口写通道信号和默认值：

|   信号   |     描述     | 方向  | 是否强制 |  默认值  |
| :------: | :----------: | :---: | :------: | :------: |
|   ACLK   |   公共时钟   | 输入  |   强制   |    -     |
| ARESETn  |   公共复位   | 输入  |   强制   |    -     |
|   AWID   |   写地址ID   | 输入  |   强制   |    -     |
|  AWADDR  |    写地址    | 输入  |   强制   |    -     |
| AWREGION |    写区域    | 输入  |   可选   |    -     |
|  AWLEN   |   突发长度   | 输入  |   强制   |    -     |
|  AWSIZE  |   突发大小   | 输入  |   强制   |    -     |
| AWBURST  |   突发类型   | 输入  |   强制   |    -     |
|  AWLOCK  |   锁定类型   | 输入  |   可选   |    -     |
| AWCACHE  |  Cache类型   | 输入  |   可选   |    -     |
|  AWPROT  |   保护类型   | 输入  |   可选   |    -     |
|  AWQOS   |    QoS值     | 输入  |   可选   |    -     |
| AWVALID  |  写地址有效  | 输入  |   强制   |    -     |
| AWREADY  | 写地址准备好 | 输出  |   强制   |    -     |
|  WDATA   |    写数据    | 输入  |   强制   |    -     |
|  WSTRB   |  写字节使能  | 输入  |   强制   |    -     |
|  WLAST   |    写最后    | 输入  |   可选   |    -     |
|  WVALID  |  写有效输入  | 输入  |   强制   |    -     |
|  WREADY  |   写准备好   | 输出  |   强制   |    -     |
|   BID    |    响应ID    | 输出  |   强制   |    -     |
|  BRESP   |    写响应    | 输出  |   可选   | 00，OKAY |
|  BVALID  |  写响应有效  | 输出  |   强制   |    -     |
|  BREADY  |  响应准备好  | 输入  |   强制   |    -     |

主接口读通道信号和默认值：

|   信号   |     描述     | 方向  | 是否强制 |    默认值     |
| :------: | :----------: | :---: | :------: | :-----------: |
|   ARID   |   读地址ID   | 输出  |   可选   |      全0      |
|  ARADDR  |    读地址    | 输出  |   强制   |       -       |
| ARREGION |    读区域    | 输出  |   可选   |      0x0      |
|  ARLEN   |   突发长度   | 输出  |   可选   |  全0，长度1   |
|  ARSIZE  |   突发大小   | 输出  |   可选   | 数据总线宽度  |
| ARBURST  |   突发类型   | 输出  |   可选   | 01，递增模式  |
|  ARLOCK  |   锁定类型   | 输出  |   可选   | 全0，一般访问 |
| ARCACHE  |  Cache类型   | 输出  |   可选   |     0000      |
|  ARPROT  |   保护类型   | 输出  |   强制   |       -       |
|  ARQOS   |    QoS值     | 输出  |   可选   |     0000      |
| ARVALID  |  读地址有效  | 输出  |   强制   |       -       |
| ARREADY  | 读地址准备好 | 输入  |   强制   |       -       |
|   RID    |   读数据ID   | 输入  |   可选   |       -       |
|  RDATA   |    读数据    | 输入  |   强制   |       -       |
|  RRESP   |    读响应    | 输入  |   可选   |       -       |
|  RLAST   |    读最后    | 输入  |   可选   |       -       |
|  RVALID  |    读有效    | 输入  |   强制   |       -       |
|  RREADY  |   读准备好   | 输出  |   强制   |       -       |

存储器从接口读通道信号和默认值：

|   信号   |     描述     | 方向  | 是否强制 |  默认值  |
| :------: | :----------: | :---: | :------: | :------: |
|   ARID   |   读地址ID   | 输入  |   强制   |    -     |
|  ARADDR  |    读地址    | 输入  |   强制   |    -     |
| ARREGION |    读区域    | 输入  |   可选   |    -     |
|  ARLEN   |   突发长度   | 输入  |   强制   |    -     |
|  ARSIZE  |   突发大小   | 输入  |   强制   |    -     |
| ARBURST  |   突发类型   | 输入  |   强制   |    -     |
|  ARLOCK  |   锁定类型   | 输入  |   可选   |    -     |
| ARCACHE  |  Cache类型   | 输入  |   可选   |    -     |
|  ARPROT  |   保护类型   | 输入  |   可选   |    -     |
|  ARQOS   |    QoS值     | 输入  |   可选   |    -     |
| ARVALID  |  读地址有效  | 输入  |   强制   |    -     |
| ARREADY  | 读地址准备好 | 输出  |   强制   |    -     |
|   RID    |   读数据ID   | 输出  |   强制   |    -     |
|  RDATA   |    读数据    | 输出  |   强制   |    -     |
|  RRESP   |    读响应    | 输出  |   可选   | 00，OKAY |
|  RLAST   |    读最后    | 输出  |   强制   |    -     |
|  RVALID  |    读有效    | 输出  |   强制   |    -     |
|  RREADY  |   读准备好   | 输入  |   强制   |    -     |

#### 主设备地址

AxADDR：规范并没有规定该信号的最小长度，如果系统地址总线比主设备地址信号更宽，则额外的高地址位全部设为0，如果更窄，则多余的高地址位不能连接到系统地址总线。

**注意：一般情况下主设备支持32bit地址，主设备可选支持到至多64bit地址。**

#### 从设备地址

AxADDR：规范并没有规定该信号的最小长度，同时规范也不要求从设备对系统数据总线宽度内的数据使用低地址位进行寻址，并假设这些低地址位为全0，如果从设备的地址线比互联器更宽，则多余的高低地址位默认全0。

通常一个存储器从设备至少能够完全译码整个4KB地址空间。

#### 存储器从设备

AxLOCK：规范不要求存储器从设备使用AxLOCK输入信号，然而，支持独占访问事务的存储器从设备需要这些信号。

AxCACHE：规范不要求存储器从设备使用AxCACHE信号，如果一个存储器从设备不支持Cache行为或所有的事务以相同的方式Cache，则该设备不需要这个信号。

#### 写事务

WSTRB[3:0]：如果主设备总是执行整个数据总线宽度的写事务，则规范不要求主设备使用写字节使能信号，写字节使能的默认值是全1。

WLAST：规范不要求从设备使用WLAST信号，因为已定义写突发长度，从设备可以根据突发长度AWLEN[7:0]信号计算出最后一次写数据传输。

#### 读事务

RLAST：规范不要求主设备使用RLAST信号，因为已定义读突发长度，主设备可以根据突发长度ARLEN[7:0]信号计算出最后一次读数据传输。

#### 响应信号

RRESP，BRESP：如果主设备不需要执行独占访问事务也不需要事务错误通知，则主设备可以不使用RRESP与BRESP输入信号；如果从设备不需要支持独占访问事务也不需要生成错误响应，则从设备可以不使用RRESP与BRESP输出信号。

#### 不安全和安全访问

AxPROT：规范不要求从设备区分非安全和安全访问，也不要求任何额外的保护支持，因此不要求从设备支持AxPROT输入信号。

**注意：要特别注意AxPROT信号，AxPROT[1]信号表示事务是否为安全事务，不正确的设置可能会导致不正确的系统行为。**
