## 綜述

**本文參考分析整理總結了AMBA AXI and ACE Protocol Specification文檔的AXI總線協議規範部分，錯誤之處歡迎指出。**

AMBA AXI協議支持高性能高頻的系統設計，該協議擁有以下優點：

* 適合高帶寬和低延遲的設計
* 不需要複雜的橋即可提供高頻操作
* 可以滿足多種組件的接口需求
* 適合高初始訪問延遲的存儲器控制器
* 提供互聯架構實現的靈活性
* 向後兼容AHB與APB接口

同時，該協議還擁有以下特點：

* 分離的地址/控制和數據階段
* 通過使用字節選通信號的方式支持非對齊數據傳輸
* 使用突發傳輸時只需要傳輸起始地址
* 允許地址信息提前於實際數據傳輸發送
* 分離的讀寫數據通道，這可以提供低損耗的DMA
* 支持發出多個未完成的地址
* 支持亂序傳輸完成
* 允許簡單添加寄存器階段以提供時序收斂

AXI協議同時包含了低功耗操作所需的信號擴展，也包含了AXI4-Lite協議，該協議是AXI4的子集，有著更簡單的控制寄存器接口和組件。

## AXI通道簡述

### 綜述

AXI協議基於突發傳輸，定義了下列獨立事務（一個事務可能包含多次傳輸）通道：

* 讀地址
* 讀數據
* 寫地址
* 寫數據
* 寫響應

地址通道攜帶描述被傳輸數據性質的控制信息，數據在主設備和從設備間通過以下方式傳輸：

1. 寫數據通道從主設備傳輸數據到從設備，在寫傳輸時，從設備使用寫響應通道通知主設備傳輸完成。
2. 讀數據通道從從設備傳輸數據到主設備。

寫數據的過程如下圖所示：

![avatar](pic/1.png)

讀數據的過程如下圖所示：

![avatar](pic/2.png)

每一個通道都擁有自己的VALID與READY信號用於實現握手，其中VALID信號表示通道的地址、數據或控制信息已經可用，而READY信號則表示接收方已準備好接收信息，其中，讀數據和寫數據通道還擁有LAST信號，該信號用於指示當前傳輸是否為當前事務中的最後一次傳輸。

### 讀地址與寫地址通道

讀事務與寫事務都擁有其自己的地址通道，對應的地址通道會攜帶一次事務所需的全部地址和控制信息。

### 讀數據通道

讀數據通道攜帶從設備傳送給主設備的數據和響應信息，該通道包括兩部分：

1. 位寬可為8、16、32、64、128、256、512、1024bit的數據總線。
2. 表示讀事務完成狀態的讀響應信號。

### 寫數據通道

寫數據通道攜帶主設備傳送給從設備的數據，該通道包括兩部分：

1. 位寬可為8、16、32、64、128、256、512、1024bit的數據總線。
2. 為每一個8bit數據準備的字節選通信號，用於指示數據的哪幾個字節是有效的。

寫數據通道總是被buffer的，因此主設備可以在未收到前一次寫事務的從設備響應消息時再次執行寫操作。

### 寫響應通道

從設備使用寫響應通道回應寫事務，全部的寫事務都需要寫響應通道的完成信號，並且完成信號僅在一個寫事務徹底完成時才產生，而並不會在每次數據傳輸時都產生。

## AXI互聯結構

一個典型的AXI系統結構如下：

![avatar](pic/3.png)

AXI協議為以下接口提供了單一的接口定義：

* 在主設備和互聯器（Interconnect）之間
* 在從設備和互聯器之間
* 在主設備和從設備之間

該接口定義支持不同的互聯器實現，設備之間的互聯器等效於另一個擁有對稱主端口和從端口的設備，真正的主設備和從設備可以連接到對應的端口。

大多數的系統使用如下三種互聯拓撲之一：

* 共享的地址和數據總線
* 共享的地址總線以及多條數據總線
* 多層，具有多個地址和數據總線

在大多數的系統中，地址通道帶寬需求遠小於數據通道帶寬需求。使用共享總線以及多條數據總線的拓撲結構實現並行數據傳輸時，可以在系統效率和互聯複雜性間取得平衡。

## AXI中使用寄存器切片

每一個AXI通道都只能單項傳輸信息，並且架構並沒有要求各個通道間具有固定的時序依賴要求。因此，寄存器切片可以插入到任何通道的任何位置，不過這會帶來額外的延遲（Latency）。

以下兩點是可能的：

* 在延遲和最大操作頻率之間取得平衡。
* 在處理器和高性能存儲器之間實現直接而又快速的鏈接，但同時又使用寄存器切片隔離性能不敏感外設的長路徑。

## AXI術語

### AXI組件與拓撲

下列術語描述了AXI組件：

* 組件（Component）
* 主組件（Master component）
* 從組件（Slave component），從組件包含存儲器子組件和外設子組件
* 互聯組件

對於特定的AXI傳輸，上游（Upstream）與下游（Downstream）指代AXI拓撲中AXI組件的相對位置。

### AXI傳輸與存儲器類型

當AXI主設備發起AXI操作時，對於AXI從設備：

* AXI總線上所需的完整操作集形成AXI事務（Transaction）。
* 任何傳輸的有效數據都作為一次AXI突發傳輸（Burst）。
* 一次突發傳輸可以包含多次數據傳輸，一次數據傳輸稱為一拍（Beat）。

## AXI信號描述

下列信號被用於AXI3和AXI4。

### 公共信號

| 信號名 | 來源 | 描述 |
| :-----: | :----: | :------------------: |
| ACLK | 時鐘源 | 公共時鐘信號 |
| ARESETn | 復位源 | 公共復位信號，低有效 |

**所有信號都在公共時鐘的上升沿被採樣。**

### 寫地址通道信號

| 信號名 | 來源 | 描述 |
| :------: | :----: | :----------------------------------------------------------------------------: |
| AWID | 主設備 | 寫地址ID，該信號用於標識寫地址組 |
| AWADDR | 主設備 | 寫地址，寫突發操作中第一次數據傳輸的地址 |
| AWLEN | 主設備 | 突發長度，這個字段標識每次突發傳輸的傳輸次數 |
| AWSIZE | 主設備 | 突發大小，這個字段表示每次突發傳輸的大小 |
| AWBURST | 主設備 | 突發類型，包括突發類型和突發大小信息，該字段決定了每次突發傳輸時地址的計算方法 |
| AWLOCK | 主設備 | 鎖定類型，提供關於傳輸時原子特性的額外信息 |
| AWCACHE | 主設備 | 存儲器類型 |
| AWPROT | 主設備 | 保護類型 |
| AWQOS | 主設備 | 服務質量，即每次寫傳輸的QoS標識符，僅AXI4支持 |
| AWREGION | 主設備 | 區域標識符，允許一個從設備的單個物理接口用作多個邏輯接口，僅AXI4支持 |
| AWUSER | 主設備 | 用戶定義信號，可選 |
| AWVALID | 主設備 | 主設備給出的地址和相關控制信號有效 |
| AWREADY | 從設備 | 從設備已準備好接收地址和相關的控制信號 |

### 寫數據通道信號

| 信號名 | 來源 | 描述 |
| :----: | :----: | :--------------------------------------------------: |
| WID | 主設備 | 寫數據ID，該信號用於標識寫數據傳輸，僅AXI3支持 |
| WDATA | 主設備 | 寫出的數據 |
| WSTRB | 主設備 | 數據的字節選通，數據中每8bit對應這裡的1bit |
| WLAST | 主設備 | 該信號用於標識當前傳輸是否為突發傳輸中的最後一次傳輸 |
| WUSER | 主設備 | 用戶定義信號，可選 |
| WVALID | 主設備 | 主設備給出的數據和字節選通信號有效 |
| WREADY | 從設備 | 從設備已準備好接收數據選通信號 |

### 寫響應通道信號

| 信號名 | 來源 | 描述 |
| :----: | :----: | :--------------------------------: |
| BID | 從設備 | 寫響應ID，該信號用於標識寫響應傳輸 |
| BRESP | 從設備 | 寫響應，該信號表示寫傳輸的狀態 |
| BUSER | 從設備 | 用戶定義信號，可選 |
| BVALID | 從設備 | 從設備給出的寫響應信號有效 |
| BREADY | 主設備 | 主設備已準備好接收寫響應信號 |

### 讀地址通道信號

| 信號名 | 來源 | 描述 |
| :------: | :----: | :----------------------------------------------------------------------------: |
| ARID | 主設備 | 讀地址ID，該信號用於標識讀地址組 |
| ARADDR | 主設備 | 讀地址，讀突發操作中第一次數據傳輸的地址 |
| ARLEN | 主設備 | 突發長度，這個字段標識每次突發傳輸的傳輸次數 |
| ARSIZE | 主設備 | 突發大小，這個字段表示每次突發傳輸的大小 |
| ARBURST | 主設備 | 突發類型，包括突發類型和突發大小信息，該字段決定了每次突發傳輸時地址的計算方法 |
| ARLOCK | 主設備 | 鎖定類型，提供關於傳輸時原子特性的額外信息 |
| ARCACHE | 主設備 | 存儲器類型 |
| ARPROT | 主設備 | 保護類型 |
| ARQOS | 主設備 | 服務質量，即每次讀傳輸的QoS標識符，僅AXI4支持 |
| ARREGION | 主設備 | 區域標識符，允許一個從設備的單個物理接口用作多個邏輯接口，僅AXI4支持 |
| ARUSER | 主設備 | 用戶定義信號，可選 |
| ARVALID | 主設備 | 主設備給出的地址和相關控制信號有效 |
| ARREADY | 從設備 | 從設備已準備好接收地址和相關的控制信號 |

### 讀數據通道信號

| 信號名 | 來源 | 描述 |
| :----: | :----: | :--------------------------------------------------: |
| RID | 從設備 | 讀數據ID，該信號用於標識讀數據傳輸 |
| RDATA | 從設備 | 讀出的數據 |
| RRESP | 從設備 | 讀響應，這信號表示讀傳輸的狀態 |
| RLAST | 從設備 | 該信號用於標識當前傳輸是否為突發傳輸中的最後一次傳輸 |
| RUSER | 從設備 | 用戶定義信號，可選 |
| RVALID | 從設備 | 從設備給出的數據和響應信息有效 |
| RREADY | 主設備 | 主設備已準備好接收讀取的數據和響應信息 |

### 低功耗接口信號

| 信號名 | 來源 | 描述 |
| :-----: | :--------: | :------------------------------------------------------------------------------: |
| CSYSREQ | 時鐘控制器 | 系統退出低功耗狀態請求，外設的系統時鐘控制器通過該信號發出請求用於離開低功耗狀態 |
| CSYSACK | 外設 | 退出低功耗狀態響應，外設響應系統低功耗狀態退出請求時使用的信號 |
| CACTIVE | 外設 | 時鐘激活，該信號表示外設需要時鐘信號 |

## 單接口需求

這一部分描述了單個主設備和單個從設備之間的基本AXI協議事務需求。

### 時鐘

每個AXI組件都需要一個時鐘信號ACLK，全部的信號都在ACLK的上升沿被採樣，一切輸出信號都必須在ACLK的上升沿之後發生改變。

在主從接口之間的輸入輸出信號間不能有組合路徑。

### 復位

AXI協議使用低有效復位信號ARESETn，該信號是可以異步拉低，但必須在ACLK的上升沿同步釋放。

在復位期間，下列信號需要遵循特定的要求：

* 主接口必須拉低ARVALID、AWVALID與WVALID信號。
* 從接口必須拉低RVALID與BVALID信號。
* 其它信號則可以為任意值。

在ARESETn被釋放後的下一個時鐘上升沿，主設備可以拉高ARVALID、AWVALID與WVALID信號，如下圖所示：

![avatar](pic/4.png)

### 基本讀寫事務

#### 握手過程

五個事務通道都使用VALID/READY作為握手信號，傳輸地址、數據和控制信息，使用這種握手方式，主從雙方都可以對傳輸速度進行控制。源端產生VALID信號意味著其地址、數據或控制信息有效，目的端產生READY信號意味著它可以接收信息，只有當雙方的VALID與READY信號都為高時傳輸才會開始。

**在主從接口之間的輸入輸出信號間不能有組合路徑。**

在下圖中，源端在T1之後給出地址、數據或控制信息，並令VALID有效，在T2之後，目的端檢測到VALID有效並給出READY有效信息，在T3階段傳輸會發生，因此在T3階段及之前，源端不能釋放或改變需要傳輸的信息。

![avatar](pic/5.png)

**源端必須在令VALID信號有效之後再等待READY信號有效，一旦VALID有效，源端必須等待握手發生，即在保持VALID不變的情況下，等待目的端的READY信號有效。**

在下圖中，目的端首先在T1階段之後令READY信號有效，源端在T2階段之後給出地址、數據或控制信息，並令VALID有效，然後在T3階段開始傳輸，在這種情況下，傳輸只消耗了一個時鐘週期，而在上面那種情況下，則消耗了兩個時鐘週期。

![avatar](pic/6.png)

**目的端可以在自身READY信號無效的情況下，等待源端的VALID信號有效，這一條規則和上一條規則必須同時遵守，否則可能造成死鎖等待，同時，在VALID有效前，即使READY已經有效，也可以再次令READY無效。**

在下圖中，兩端的VALID/READY信號同時有效，則傳輸立刻在下一個時鐘週期開始：

![avatar](pic/7.png)

#### 通道信號需求

每個通道都有自己的握手信號對：

* 寫地址通道：AWVALID/AWREADY。
* 寫數據通道：WVALID/WREADY。
* 寫響應通道：BVALID/BREADY。
* 讀地址通道：ARVALID/ARREADY。
* 讀數據通道：RVALID/RREADY。

寫地址通道：

主設備僅當輸出有效的地址和控制信息時才能使能AWVALID信號，在從設備的AWREADY信號有效後的第一個時鐘上升沿，主設備的AWVALID信號必須保持有效。

AWREADY信號的默認狀態可以為高也可以為低電平，規範推薦默認狀態為高電平。當該信號為高電平時，意味著從設備一定可以接受任何有效的地址。

**注意：規範不推薦AWREADY信號默認為低電平是因為這會強制使傳輸週期拉長到至少兩個時鐘週期，一個週期用於使能AWVALID信號，另一個週期則用於使能AWREADY信號。**

寫數據通道：

在寫突發過程中，主設備可以僅當它輸出有效數據時才使能WVALID信號，同樣的，該信號必須在從設備WREADY信號有效後的第一個時鐘上升沿保持有效。

WREADY信號默認可以為高電平，但這意味著從設備總是可以在一個時鐘週期內接收待寫入的數據。

主設備在進行突發事務中的最後一次寫傳輸時，必須令WLAST信號有效。

寫響應通道：

從設備輸出有效的寫響應信號後才能驅動BVALID信號，該信號在BREADY信號有效後的第一個時鐘上升沿保持有效。

BREADY信號默認可以為高電平，但此時主設備必須總能在一個時鐘週期內接收寫響應。

讀地址通道：

主設備僅當輸出有效的地址和控制信息時才能使能ARVALID信號，在從設備的AWREADY信號有效後的第一個時鐘上升沿，主設備的ARVALID信號必須保持有效。

ARREADY信號的默認狀態可以為高也可以為低電平，規範推薦默認狀態為高電平。當該信號為高電平時，意味著從設備一定可以接受任何有效的地址。

**注意：規範不推薦ARREADY信號默認為低電平是因為這會強制使傳輸週期拉長到至少兩個時鐘週期，一個週期用於使能ARVALID信號，另一個週期則用於使能ARREADY信號。**

讀數據通道：

從設備只有在輸出有效讀數據時才能使能RVALID信號，同時在主設備的RREADY信號有效後的第一個時鐘上升沿必須保持有效。**即使從設備只有一個讀數據源，它也必須在收到數據請求時才令RVALID信號有效。**

主接口使用RREADY信號表示它可以接收數據，RREADY信號默認可以為高電平，但此時主設備啓動讀事務時必須能立即接收數據。

從設備在進行突發傳輸事務中的最後一次傳輸時必須使能RLAST信號。


### 通道間的關係

AXI協議要求各個通道間必須保持如下關係：

* 寫響應必須緊跟在其所屬的寫事務的最後一次寫傳輸之後。
* 讀數據必須緊跟著它的地址之後。
* 通道握手必須符合通道握手依賴關係。

除此之外，協議沒有規定其它的任何關係，這意味著，在一個事務中，寫數據信號可以提前於寫地址信號，這種情況通常發生在寫地址的通道的寄存器階段要更多時， 同樣，寫數據可以和寫地址信號同時出現。

**注意：當互聯器需要決定目標地址空間或從設備地址空間時，必須對地址和寫數據重排，以確保寫數據僅對其關聯的從設備有效。**

### 通道握手信號依賴關係

為了避免死鎖，下列依賴規則必須遵守：

在任何事務中：

* 發送信息的AXI接口的VALID信號不能依賴於接收信息的AXI接口的READY信號。
* 接收信號的的AXI接口在其自身的READY信號有效前可以等待對方的VALID信號。

**注意：VALID信號可以在READY信號之前有效，READY信號也可以在檢測VALID信號之前有效，這些方式都會提升傳輸效率。**

在下面的依賴圖中：

* 單頭箭頭指向的信號可以在始端信號有效前或有效後有效。
* 雙頭箭頭指向的信號只有在始端信號有效後才能有效。

#### 讀傳輸依賴

在讀傳輸中：

* 主設備在使能ARVALID前不能等待從設備使能ARREADY。
* 從設備在使能自身的ARREADY前可以等待主設備使能ARVALID。
* 從設備可以在主設備使能ARVALID前使能ARREADY。
* 從設備在使能RVALID前必須等待ARVALID和ARREADY信號都使能。
* 從設備在使能RVALID後才能等待主設備使能RREADY。
* 主設備在使能RREADY前可以等待從設備使能RVALID。
* 主設備在從設備使能RVALID前可以使能RREADY。

總結就是：VALID信號發出方，必須首先使能VALID，才能等待READY信號；READY信號發出方，不必等待VALID有效，就可以發出READY信號，也可以等待VALID有效，再發出READY信號，同時，讀數據通道的VALID信號不能保持常態有效。

依賴關係圖如下：

![avatar](pic/8.png)

#### 寫傳輸依賴

* 主設備在使能AWVALID或WVALID後才能等待從設備使能AWREADY或WREADY。
* 從設備在使能AWREADY前可以等待AWVALID或WVALID有效。
* 從設備在AWVALID或WVALID有效前可以先使能AWREADY。
* 從設備可以在使能WREADY前等待AWVALID與WVALID有效。
* 從設備在AWVALID或WVALID有效前可以先使能WREADY。
* 從設備必須等待WVALID與WREADY都有效後才能使能BVALID。
* 從設備必須等待WLAST有效後才能使能BVALID，因為寫響應必須發生在一次寫事務中的最後一次數據傳輸後。
* 從設備必須在使能BVALID後才能等待主設備使能BREADY。
* 主設備可以在使能BREADY前等待BVALID。
* 主設備可以在BVALID有效前使能BREADY。

依賴關係圖如下：

![avatar](pic/9.png)

#### AXI4寫響應依賴

注意：

* 該額外的依賴關係是AXI3所期望的，因為AXI3不希望任何組件在接收到有效的地址前接收寫數據並提供寫響應信號（由於AXI3允許寫數據和寫響應在寫地址被接受前發出，因此AXI4從設備與AXI3從設備不完全兼容，而主設備則完全兼容，強烈推薦AXI3從設備按照更嚴格的AXI4寫響應依賴圖實現）。
* 通過發出寫響應，從設備負責對寫事務和所有後續事務進行冒險檢查。

依賴關係如下：

* 主設備在使能AWVALID或WVALID後才能等待從設備使能AWREADY或WREADY。
* 從設備在使能AWREADY前可以等待AWVALID或WVALID有效。
* 從設備可以在使能WREADY前等待AWVALID與WVALID有效。
* 從設備在AWVALID或WVALID有效前可以先使能WREADY。
* 從設備等待AWVALID、AWREADY、WVALID、WREADY有效後才能使能BVALID。
* 從設備必須等待WLAST有效後才能使能BVALID，因為寫響應必須發生在一次寫事務中的最後一次數據傳輸後。
* 從設備必須在使能BVALID後才能等待主設備使能BREADY。
* 主設備可以在使能BREADY前等待BVALID。
* 主設備可以在BVALID有效前使能BREADY。

依賴關係圖如下：

![avatar](pic/10.png)

### 事務結構

#### 地址結構

AXI協議是基於突發的，主設備向從設備傳送事務的控制信息和第一個字節的地址，然後，從設備必須在此後的每次傳輸中計算數據地址。

突發傳輸不能跨越4KB地址邊界。

**注意：避免突發傳輸跨越兩個從設備的邊界，同時，必須使用從設備支持的地址增量。**

突發長度：

突發長度由下列字段指定：

* 對於讀傳輸，ARLEN[7:0]。
* 對於寫傳輸：AWLEN[7:0]。

AXI3支持1~16的突發長度。

AXI4：

* 對於INCR突發類型，支持1~256的突發長度。
* 對於其它突發類型，支持1~16的突發長度。

AXI3中的突發長度定義如下：

突發長度 = AxLEN[3:0] + 1

AXI4中的突發長度定義如下：

突發長度 = AxLEN[7:0] + 1

在使用突發傳輸時，必須遵守如下規則：

* 對於回繞傳輸，突發長度必須為2、4、8或16。
* 突發傳輸不能跨越4KB地址邊界。
* 突發傳輸不支持過早結束。

在AXI4中，突發類型為INCR且突發長度大於16的突發傳輸可以轉換為多個長度更短的突發傳輸，即使突發屬性表明事務是不可修改的。在這種情況下，生成的突發事務必須保持與原始事務相同的事務特徵，唯一的例外是：

* 突發長度變小。
* 突發地址被適當調整。

**注意：為了實現AXI3兼容性，將長突發傳輸轉換為多個短突發傳輸是必要的，同時，這也可以減少長突發對QoS保證的影響。**

突發大小：

該字段表示每次突發數據傳輸或每個節拍中中數據的字節數，由以下字段指定：

* 對於讀傳輸，ARSIZE[2:0]。
* 對於寫傳輸，AWSIZE[2:0]。

突發大小 = 2^AxSIZE

如果AXI的總線比突發大小寬，AXI接口每次傳輸就必鬚根據地址判斷使用哪幾條數據線，任何一次傳輸的大小都不能超過事務中任一代理的數據總線寬度。

突發類型：

AXI協議定義了三種突發類型：

* 固定（FIXED）：在突發事務中，每次傳輸的地址一致，有效的字節線也是一致的，但是可以通過WSTRB信號控制實際有效的字節。這種方式通常用於對同一位置的重復訪問，如讀取或清空FIFO時。
* 遞增（INCR）：在一次遞增突發事務中，每次傳輸，地址都會在之前的地址基礎上遞增，遞增量為傳輸大小。
* 回繞（WRAP）：這種類型和遞增方式類似，但是，地址到達上界後，地址就會回繞到下界。

在回繞傳輸中，有幾點需要注意：

* 起始地址必須對齊突發大小。
* 突發長度必須為2、4、8或16。

回繞突發方式的行為如下：

* 突發所使用的地址下界會對齊到傳輸數據的總量，這也被稱為回繞邊界。
* 在每次傳輸後，地址都會像遞增突發方式一樣遞增，但是，一旦遞增後的地址超過回繞邊界，就會回到回繞邊界的開始位置。
* 第一次傳輸的地址可以大於回繞邊界的開始位置。

回繞突發方式通常用於Cache行的訪問。

突發類型由如下字段指定：

* 對於讀傳輸，ARBURST[1:0]。
* 對於寫傳輸，AWBURST[1:0]。

字段取值如下：

| AxBURST[1:0] | 突發類型 |
| :----------: | :------: |
| 00 | FIXED |
| 01 | INCR |
| 10 | WRAP |
| 11 | 保留 |

#### 數據讀寫結構

**寫選通：**

當WSTRB[i]為高電平時，對應的WDATA[(8i+7):8i]數據線有效，當WVALID為低電平時，寫選通信號可以為任何值，不過標準推薦寫選通信號全0或保持上一次的值。

**狹窄傳輸（Narrow transfer）：**

當主設備產生一個數據寬度小於數據總線的傳輸時，地址和控制信號按照如何方式決定使用哪些字節線：

* 在遞增或回繞突發模式中，每拍使用不同的字節線。
* 在固定突發模式中，每拍使用相同的字節線。

**字節不變性（Byte invariance）：**

在訪問單個存儲器空間中的大小端混合數據時，AXI協議使用字節不變性大小端模式。

字節不變性大小端模式是指：

* 數據元素使用相同連續的內存字節，而不管數據的大小端如何。
* 大小端決定了存儲器中的字節順序，也就是說存儲器中的第一個字節是數據元素的MSB還是LSB。
* 字節傳輸時，只需要將字節傳輸到地址給定的位置，而不需要考慮該字節是數據元素的哪一部分。

通常情況下，大多數小端組件可以直接連接到一個字節不變性接口，而只支持大端的組件則需要一個轉換器。

**非對齊傳輸：**

AXI支持非對齊傳輸，對於任何數據寬度大於一個字節的突發傳輸而言，第一個字節的訪問都可能是非對齊的。

一個主設備可以：

* 使用低位地址線發送一個非對齊的開始地址。
* 提供對齊的地址並使用字節選通信號線發送非對齊的開始地址。

注意：

* 低位地址線上的信息必須與字節選通信號提供的信息一致。
* 從設備不需要根據主設備傳遞的對齊信息執行任何特別的動作。

#### 數據讀寫響應結構

AXI協議提供了讀寫事務中的響應信號：

* 對於讀事務而言，從設備在讀數據通道上發送響應信息，使用RRESP[1:0]信號。
* 對於寫事務而言，從設備在寫響應通道上發送響應信息，使用BRESP[1:0]信號。

響應共有四種類型：

* OKAY：一般訪問成功。該信號表示一個一般訪問成功，也表示一個獨佔訪問失敗。
* EXOKAY：獨佔訪問成功。
* SLVERR：從設備錯誤。該信號表示向從設備的訪問已成功，但從設備希望向原始主設備返回一個錯誤條件。
* DECERR：譯碼錯誤。通常由互聯器生成，表示根據給定的事務地址找不到從設備。

RRESP與BRESP的取值如下：

| RRESP/BRESP[1:0] | 響應 |
| :--------------: | :----: |
| 00 | OKAY |
| 01 | EXOKAY |
| 10 | SLVERR |
| 11 | DECERR |

對於寫事務而言，只有當整個突發事務結束時才會發出一個響應。

對於讀事務而言，從設備可以針對突發事務中的每個傳輸發送不同的響應。

協議規定，指定數量的數據傳輸必須全部被執行，即使發生了錯誤。

下面詳細介紹不同的響應所對應的可能的情況：

OKAY響應可能在下列情況出現時產生：

* 一個一般訪問成功。
* 一個獨佔訪問失敗。
* 獨佔訪問指定的從設備不支持獨佔訪問。

EXOKAY響應可能在下列情況出現時產生：

* 一個獨佔訪問成功。

對於SLVERR響應，為了簡化系統監控和調試，規範推薦這種錯誤響應只用於錯誤條件，而不用於除了事件外的一般通知，SLVERR響應可能在下列情況出現時發生：

* FIFO或緩衝區已滿或已空。
* 嘗試不支持的傳輸大小。
* 嘗試寫一個只讀位置。
* 從設備超時。
* 嘗試訪問已禁用或已掉電功能。

對於DECERR響應，只有當互聯器不能找到對應的從設備時才會返回。規範推薦互聯器此時路由到一個默認的從設備，並由該默認從設備返回DECERR響應。

AXI協議要求事務中的全部數據傳輸必須都被完成，即使發生了錯誤，因此任何給定DECERR響應的組件滿足這個需求。

## 事務屬性

### 事務類型和屬性

從設備可以分為以下兩種類型：

* 存儲器從設備：一個需要正確處理全部事務類型的存儲器從設備。
* 外設從設備：一個外設從設備實現了定義的訪問方法。通常，這被記載在組件的datasheet中。對於未定義的訪問方法，外設從設備必須能夠完成事務，但是規範並不要求從設備能夠正確的完成所操作，它之要求從設備能夠繼續處理接下來的事務，這主要是為了避免系統發生死鎖。

AXI協議定義了一整套支持存儲器和外設從設備的事務屬性，使用ARCACHE與AWCACHE信號來表示（後面使用AxCACHE指代這兩個信號），這些信號控制事務通過系統進行的方式與系統級Cache處理事務的方式。

### AXI3存儲器屬性信號

在AXI3中，AxCache[3:0]指定了事務的可Buffer（Bufferable）、可Cache（Cacheable）與分配（Allocate）屬性：

| AxCACHE | 值 | 事務屬性 |
| :-----: | :---: | :-----------------: |
| [0] | 0/1 | 不可Buffer/可Buffer |
| [1] | 0/1 | 不可Cache/可Cache |
| [2] | 0/1 | 不可讀分配/可讀分配 |
| [3] | 0/1 | 不可寫分配/可寫分配 |

可Buffer（B）是指，互聯器或者其它任何組件是否可以讓事務延遲任意個週期到達目的端，通常該屬性僅與寫請求相關。
可Cache（C）是指，傳輸分配是否被允許，以及原始事務特徵是否一定匹配最終的事務特徵，即多次寫事務是否可以被合併（對於寫事務）或某個位置的內容是否可以被預取（對於讀事務）或某個讀操作是否可以被分解為多個讀事務（對於讀事務）。
可讀分配（RA）是指：是否推薦事務進行讀分配，但不是強制的，當不可Cache時，該位必須為0。
可寫分配（WA）是指：是否推薦事務進行寫分配，但不是強制的，當不可Cache時，該位必須為0。

### AXI4對存儲器屬性信號的變更

AXI4做出了如下變更：

* AxCACHE[1]為重命名為可修改（Modifiable）位。
* 對於不可修改事務，定義了傳輸順序要求。
* 更新了讀分配和寫分配的含義。

#### AxCACHE[1]，可修改

在AXI4中，AxCACHE[1]位為可修改位，當該位為高時，表示事務特徵可修改，當改位為低時，表示事務特徵不可修改。

**注意：該位僅僅是被重命名，因為新的名字能更好地描述該位的用途，而實際功能並未改變。**

不可修改事務：

一個不可事務傳輸不能分割為多個事務，也不能和其它事務合併，下表中的參數也不能被改變：

| 參數 | 信號 |
| :------: | :----------------: |
| 傳輸地址 | AxADDR以及AxREGION |
| 突發大小 | AxSIZE |
| 突發長度 | AxLEN |
| 突發類型 | AxBURST |
| 鎖定類型 | AxLOCK |
| 保護類型 | AxPROT |

而AxCache信號僅被允許由可Buffer修改為不可Buffer，不允許其它的修改。

事務ID和QoS可被修改。

一個突發長度超過16的不可修改事務可被分割為多個事務，產生的事務仍然必須滿足上述要求，除了：

* 突發長度減小。
* 突發地址被適當地修改。

對於獨佔的不可修改傳輸，在保持總訪問字節數不變的情況下，允許修改AxSIZE與AxLEN。

注意：

* 存在一些無法滿足不可修改事務需求的情況，例如，傳輸降級到更狹窄的總線時，事務的傳輸大小AxSIZE必須修改。
* 一個組件可以包含自定義的機制來通知事務特徵發生了修改，這有助於軟件調試。

可修改事務：

在可修改事務中，下列特徵可以被修改：

* 一個事務可以被分割為多個事務。
* 多個事務可以被合併為一個事務。
* 一個讀事務可以進行預取操作。
* 一個寫事務可以訪問比所需更大的地址範圍，使用WSTRB信號以確保只有合適的位置被更新。
* 在每個生成的事務中，下列信號可以被修改：傳輸地址、突發大小、突發長度、突發類型。

下列特徵不可以被修改：

* 鎖定類型，AxLOCK。
* 保護類型，AxPROT。

存儲器屬性AxCACHE可以被修改，但是任何修改都必須確保事務的可見性不會因為阻止事務傳播到所需的點或更改在Cache中尋找事務的需求而減少。任何對於存儲器屬性的修改都必須與相同地址範圍內的其它事務一致。

傳輸ID和QoS可被修改。

當修改的結果出現如下情況時是不允許的：

* 導致訪問與原始事務不同的4KB地址空間。
* 導致針對單次拷貝原子大小的區域的單次訪問變為多次訪問操作。

#### 不可修改事務的順序要求

AXI4要求滿足下列全部條件的任何事務集的順序被保證：

* 事務是不可修改的。
* 事務使用了相同的AXI ID。
* 事務目標是相同的從設備。

無論事務的地址是什麼，只要事務目標是同一個從設備，事務順序都必須被保證。

**注意：當讀寫通道上分別出現獨立的事務時，如果一個事務在另一個事務的響應被收到後才發出，則順序可以被保證，否則順序不能被保證。**

#### 讀分配與寫分配的更新含義

在AXI4中，讀分配位表示事務中是否會發生分配，寫分配位表示是否可能由於另一個事務而進行了分配。

對於讀事務，寫分配位被重定義用來表示：

* 由於先前的寫事務，該位置可能已經預先在Cache中分配（就像AXI3所定義的那樣）。
* 由於先前另一個主設備的行為，該位置可能已經預先在Cache中分配（AXI4的附加定義）。

對於寫事務，讀分配位被重定義用來表示：

* 由於先前的讀事務，該位置可能已經預先在Cache中分配（就像AXI3所定義的那樣）。
* 由於先前另一個主設備的行為，該位置可能已經預先在Cache中分配（AXI4的附加定義）。

這樣變更意味著：

* 如果AxCACHE[3:2]不等於00，事務必須在Cache中查找。
* 如果AxCACHE[3:2]等於00，事務不需要在Cache中查找。

新的AWCACHE定義如下：

| 名稱 | AXI4定義 | 描述 |
| :--------: | :------------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| AWCACHE[3] | Allocate | 當該位有效時，事務必須首先在Cache中查找，因為它可能被預先分配，同樣的，如果AWCACHE[2]有效，事務同樣需要預先在Cache中查找。而如果這兩位都為0，事務則不必查找Cache。 |
| AWCACHE[2] | Other Allocate | 當該位有效時，事務必須首先在Cache中查找，因為它可能由於其它的事務，即讀事務或來自另一個主設備的事務，在Cache中被預先分配。 |
| AWCACHE[1] | Modifiable | 當該位有效時，事務的特徵可以修改，寫事務可以被合併 |
| AWCACHE[0] | Bufferable | 當該位無效時，如果AWCACHE[3:2]為00，寫響應必須來自最終目的端。<br />當該位有效時，若AWCACHE[3:2]為00，寫響應可以來自中間點，但寫事務必須及時被最終目的端看到。<br />當該位無效時，如果AWCACHE[3:2]不為00，寫響應可以來自中間點，但寫事務必須及時被最終目的端看到。<br />當該位有效時，如果AWCACHE[3:2]不為00，寫響應可以來自中間點，同時寫傳輸可以不必被最終目的端看到。 |

新的ARCACHE定義如下：

| 名稱 | AXI4定義 | 描述 |
| :--------: | :------------: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ARCACHE[3] | Other Allocate | 當該位有效時，事務必須首先在Cache中查找，因為它可能由於其它的事務，即寫事務或來自另一個主設備的事務，在Cache中被預先分配，同樣的，如果ARCACHE[2]有效，事務同樣需要預先在Cache中查找。 |
| ARCACHE[2] | Allocate | 當該位有效時，事務必須首先在Cache中查找，因為它可能被預先分配。 |
| ARCACHE[1] | Modifiable | 當該位有效時，事務的特徵可以修改，寫事務可以被合併。 |
| ARCACHE[0] | Bufferable | 當ARCACHE[3:1]為000時該位無用。<br />當ARCACHE[3:2]為00且ARCACHE[1]為1時，若該位無效，則讀取的數據必須來自最終目的端，否則可以來自一個指向該目的端正在處理的寫事務。<br />當ARCACHE[3]有效或ARCACHE[2]有效時，該位可以用來區分寫穿和寫回存儲器類型。 |

### 存儲器類型

下列的表中給出了AxCACHE的編碼含義，其中有的類型擁有兩種編碼，其中括號內的是AXI3所採用的編碼，其它則為AXI4所採用的編碼，這主要是為了讓AXI4具有向下兼容能力：

| ARCACHE[3:0] | AWCACHE[3:0] | 存儲器類型 |
| :----------: | :----------: | :---------------------------: |
| 0000 | 0000 | 不可Buffer設備 |
| 0001 | 0001 | 可Buffer設備 |
| 0010 | 0010 | 一般不可Cache不可Buffer存儲器 |
| 0011 | 0011 | 一般不可Cache可Buffer存儲器 |
| 1010 | 0110 | 寫穿不可分配存儲器 |
| 1110(0110) | 0110 | 寫穿可讀分配存儲器 |
| 1010 | 1110(1010) | 寫穿可寫分配存儲器 |
| 1110 | 1110 | 寫穿可讀寫分配存儲器 |
| 1011 | 0111 | 寫回不可分配存儲器 |
| 1111(0111) | 0111 | 寫回可讀分配存儲器 |
| 1011 | 1111(1011) | 寫回可寫分配存儲器 |
| 1111 | 1111 | 寫回可讀寫分配存儲器 |

### 不同的存儲器屬性

訪問存儲器相同區域的多個代理可以使用不同的內存屬性，然而，為保證功能正確性，必須遵守如下幾條規則：

* 所有訪問存儲器相同區域的主設備都必須擁有該區域的一致性可Cache視圖，也就是說，要麼這些主設備的AxCACHE[3:2]均為00，或均為非00。
* 不同的主設備可以使用不同的可分配暗示信號。
* 如果一個尋址區域是一般不可Cache的，任何主設備都可以使用設備存儲器事務方式訪問。
* 如果一個尋址區域是可Buffer的，任何主設備都可以使用不可Buffer的方式訪問。

#### 改變存儲器屬性

一個特定存儲器區域的屬性可以被改變，不過這需要一個合適的流程來執行，通常如下所示：

1. 所有的主設備停止訪問該區域。
2. 某個主設備執行Cache維護操作。
3. 所有的主設備使用新屬性重啓對該區域的訪問。

### 訪問權限

AXI提供了訪問權限信號用以阻止非法事務：

* ARPROT[2:0]定義了讀訪問的訪問權限。
* AWPROT[2:0]定義了寫訪問的訪問權限。

其中，信號定義如下：

| AxPROT | 值 | 功能 |
| :----: | :---: | :-----------------: |
| [0] | 0/1 | 非特權訪問/特權訪問 |
| [1] | 0/1 | 安全訪問/不安全訪問 |
| [2] | 0/1 | 數據訪問/指令訪問 |

#### 非特權與特權訪問

一些處理器支持多種特權級，但是AXI僅支持兩種特權級，具體的映射方法可以參照具體處理器的文檔。

#### 安全與非安全訪問

該定義與ARM安全擴展中所定義的一致。


#### 指令與數據

在AXI協議規範中，該位僅僅是一種暗示，例如，若某個事務包含指令和數據的混合項，則推薦將該位設置為0，表示當前進行的是數據訪問而不是指令訪問。

### 遺留問題

AXI4在處理一些AxCACHE存儲器屬性時引入了額外的要求。

在AXI4中，所有使用相同ID且目的從設備相同的設備事務都必須按序排列。

注意：

* 這並不是AXI3的要求，任何依賴該行為的AXI4組件都不能連接到不支持該特性的AXI3互聯器上。
* ARM相信大多數的AXI3互聯器都支持所需的AXI4行為。

該規範強烈推薦任何新的AXI3設計都應該實現AXI4的要求。

對於AxCACHE位名和存儲器類型名，AX3組件可以使用AXI3或AXI4的名字。

## 多事務

### AXI事務標識符

AXI協議包含AXI ID事務標識符，主設備可以使用這個區分需要按序返回的事務。

AXI ID相同的事務必須保證順序，但是AXI ID不同的事物則不能保證順序，這意味著單個物理端口可以支持亂序事務，並據此模擬出多個邏輯端口，其中每個端口都是按序端口。

使用AXI ID，主設備可以在前面事務未完成的時候就發送新的事務，這可以提升系統效率，因為這允許事務的並行處理。

**注意：這並沒有要求主設備和從設備一定使用AXI事務ID，主設備和從設備可以同時只處理一個事務，這意味著所有的事務都是按序的，同時從設備返回的BID和RID必須和主設備發出的AXI ID一致。**

### 事務ID

每一個事務通道都擁有自己的事務ID，如下表所示：

| 事務通道 | 事務ID |
| :----------------: | :----: |
| 寫地址通道 | AWID |
| 寫數據通道，僅AXI3 | WID |
| 寫響應通道 | BID |
| 讀地址通道 | ARID |
| 讀數據通道 | RID |

**注意：AXI4協議支持基於AXI ID的擴展順序模型。**

### 事務順序

主設備可以使用AWID和ARID事務ID信號來表明它的順序要求，具體情況如下：

* 來自不同主設備的事務是不需按序的。
* 來自相同主設備但ID不同的事務是不需按序的。
* 具有相同ARID的一系列讀事務的數據傳輸必須按照主設備發出地址的順序返回。
* 具有相同AWID的一系列寫事務的數據傳輸必須按照主設備發出地址的順序返回。
* 在AWID與ARID使用相同值的讀寫事務之間是不需按序的。

**注意：AXI3因為支持寫數據交錯，因此寫數據通道中才含有WID信號，而在AXI4中，寫數據的順序必須和寫地址的順序一致，因此WID信號被移除。**

#### 事務ID信號的寬度

事務ID信號的寬度可以任意定義，然而，規範推薦下列事務ID信號寬度：

* 主設備實現至多4bit的事務ID。
* 互聯器增加額外的至多4bit的事務ID用於支持多主端口。
* 從設備實現8bit的事物ID信號支持。

對於只支持單個按序接口的主設備，將事務ID信號置為一個常量，例如0，是可以接受的。

對於不使用順序信息而將所有事務按序處理的從設備而言，事務ID信號可以在不改變從設備功能的情況下被加入。

#### 遺留問題

大多數AXI3主設備不支持寫交錯，因此為了滿足AXI4的要求不需要做任何改動，而支持寫交錯的AXI主設備必須要支持寫交錯深度的配置方法，通過將寫交錯深度設置為1來兼容AXI4。

**注意：任何需要WID信號的AXI3的組件都可以從AWID信號生成WID信號。**

## AXI4順序模型

### 順序模型的定義

AXI4協議支持基於AXI ID事務標識符的順序模型。

對於相同ID的事務來說：

* 到任何單個外設的事務順序必然與事務被發出的順序一致。
* 使用相同或重疊地址的存儲器事務的到達順序必然與事務被發出的順序一致。

**注意：在擁有多個主設備的AXI系統中，AXI ID中包含主設備的標識符，這意味著對於順序模型對於每個主設備而言是獨立的。**

AXI順序模型同時要求所有相同方向且AXI ID一致的事務的響應順序必須與事務發出順序一致。

因為讀地址和寫地址通道是獨立的，如果需要讓不同方向具有相同ID的事務有順序關係，主設備就必須在發出第二個事務之前等待接收第一個事務的響應，否則是沒有順序保證的，注意在這種情況下，主設備必須要保證收到的響應來自一個合適的點，一個來自中間AXI組件（如互聯器）的響應不能保證組件Buffer下游的組件收到事務的順序。

### 主設備順序

一個在相同方向發送攜帶有相同ID的事務時可以得到如下的順序保證：

* 事務的響應順序與發出順序一致。
* 對於到設備存儲器的事務，事務到達從設備的順序必然與發出順序一致。
* 對於一般存儲器，當事務的地址相同或有重疊時，到達的順序必然與發出順序一致，這同樣針對於可Cache的存儲器，即應用於所有AxCACHE[3:1]不為全0的存儲器。

所謂事務的地址相同或有重疊，指的是事務在相同的單拷貝原子地址範圍內至少有一個字節發生重疊。

### 互聯器順序

為了滿足順序模型的要求，互聯器必須保證以下幾點：

* 具有相同ID相同方向的、發向設備存儲器的事務順序要保證。
* 具有相同ID相同方向的、相同或重疊地址的事務順序要保證。
* 相同ID事務的寫響應順序要保證。
* 相同ID事務的讀響應順序要保證。
* 任何對AXI ID值的操作都必須保證新的事務依然保持相同的順序。
* 在事務到達其最終目的地之前，任何提供響應的組件都必須確保在事務到達其目的端之前都要維護本節給出的順序要求。

### 從設備順序

為了滿足順序模型的要求，從設備必須保證以下幾點：

* 任何已經發出響應的寫事務都必須能被任何後續的讀或寫事務所觀察到，無論其事務ID是什麼。
* 在相同事務ID的情況下，任何針對於設備存儲器的寫事務都必須能夠被任何後續針對設備存儲器的寫事務觀察到，無論響應是否發出。
* 在相同ID的情況下，任何針對一般存儲器的寫事務都必須能被後續針對相同或重疊地址的寫事務觀察到，無論響應是否發出，這同樣也適用於可Cache存儲器，即AWCACHE[3:1]不為0的存儲器。
* 針對相同ID的多個寫事務的響應的發送順序必須與事務的到達順序一致。
* 針對不同ID的多個寫事務的響應的發送順序可以是任意的。
* 任何已經發出響應的讀事務都必須能夠被任何後續的讀或寫事務所觀察到，無論其事務ID是什麼。
* 在相同事務ID的情況下，任何針對於設備存儲器的讀事務都必須能夠被任何後續針對設備存儲器的讀事務觀察到，無論響應是否發出。
* 針對相同ID的多個讀事務的響應的發送順序必須與事務的到達順序一致。
* 針對不同ID的多個讀事務的響應的發送順序可以是任意的。

### 在目的端之前發出響應

任何中間組件都可以在事務到達目的端之前發出響應，但必須確保，對於任何其它來自上游主設備的事務而言，該事務的可見性。

當訪問全部類型的存儲器時，任何針對相同或重疊地址的新事務都必須能夠觀察到中間組件發出響應對應的事務。

當訪問設備存儲器時，中間組件必須維護任何具有相同ID以及到相同從設備的事務的順序。

只有當事務的AxCACHE屬性表明中間組件可以直接發出響應時，中間組件才可以發出響應。

AXI協議要求，針對設備存儲器的訪問順序保證是針對一般存儲器的訪問順序保證的超集，這意味著當任何標記為一般存儲器訪問類型的事務被轉換為設備存儲器訪問類型時不需要移除任何原先的順序保證，為了滿足這個要求，針對相同或重疊地址的設備存儲器的訪問行為必須與一般存儲器訪問行為一致，無論其ID是什麼。

下表給出了不同存儲器類型在ID是否相同、地址是否重疊不同組合下的順序要求。

| 存儲器類型 | ID是否相同 | 地址是否重疊 | 是否要求順序 |
| :--------: | :--------: | :----------: | :----------: |
| 設備存儲器 | 是 | 是 | 是 |
| 設備存儲器 | 是 | 否 | 是 |
| 設備存儲器 | 否 | 是 | 是 |
| 設備存儲器 | 否 | 否 | 否 |
| 一般存儲器 | 是 | 是 | 是 |
| 一般存儲器 | 是 | 否 | 否 |
| 一般存儲器 | 否 | 是 | 是 |
| 一般存儲器 | 否 | 否 | 否 |

這裡說的一般存儲器，同樣適用於可Cache存儲器，即AxCACHE[3:1]不為全0的存儲器。

### 觀察順序

為了提升接口對不同順序模型接口協議的兼容性，規範提供了Ordered_Write_Observation屬性，該屬性可針對單個接口設置為True或False，如果該屬性設置為True，說明該端口擁有該屬性，否則說明該接口不支持該屬性。

一個支持Ordered_Write_Observation屬性的接口可以支持生產者/消費者順序模型以提升效率。

如果兩個擁有相同ID的寫事務可以被系統中的其它代理以與事務發出順序相同的順序觀察到事務，則該接口可以聲稱其提供了Ordered_Write_Observation支持。

如果一個接口不支持Ordered_Write_Observation特性，則僅能保證針對相同ID到相同外設的寫事務順序。為了在這種情況下支持生產者/消費者順序模型，在後續針對不同外設的寫事務發出前，必須通過BRESP等待接收前一個寫事務的響應。

## 原子訪問

### 單拷貝原子大小

AXI4協議引入了單拷貝原子大小的概念，這個術語定義了一個事務原子更新的最小字節數。AXI4協議要求大於一個單拷貝原子大小的事務必須更新至少為單拷貝原子大小的內存塊。

**注意：原子性並不定義數據更新的確切時刻。必須確保的是，沒有一個主設備可以觀察到原子數據的部分更新形式。例如，在使用許多系統數據結構例如由32bit原子元素構成的鏈表時，針對這些元素的原子更新操作必須同時更新整個32bit的值，任何一個主設備在某個時刻只觀測到其中的16bit發生更新，而在另一個時刻觀測到另外16bit發生更新的的這一行為是不可接受的。**

更複雜的系統要求支持更大的原子元素，特別是64bit原子元素，以便主設備可以使用基於更大原子元素的數據結構通信。

系統所支持的單拷貝原子大小非常重要，因為給定通信中設計的所有組件都必須支持蘇偶像的原子元素大小。如果兩個主設備正在通過互聯器和同一個從設備通信，則所有涉及到的組件都必須確保所需大小的事務被原子對待。

AXI4協議不要求特定的單拷貝原子大小，系統可以支持不同的單拷貝原子大小。

對於組內通信，不同的組件組可以擁有不同的單拷貝原子大小，在AXI4中，單拷貝原子組這一術語指的是一組可以以特定的原子性進行通信的組件。

下圖展示了如下的一個系統：

* 處理器、DSP、DRAM控制器、DMA控制器、外設、SRAM以及關聯的互聯器都在一個32bit的單拷貝原子組中。
* 處理器、DSP、DRAM控制器以及關聯的互聯器也在一個64bit的單拷貝原子組中。

![avatar](pic/11.png)

事務的原子性只有在它的起始地址正確對齊時才能得到保證，例如，對於一個64bit的單拷貝原子組來說，如果突發事務的地址沒有對齊到8字節邊界，那麼該事務就沒有任何64bit單拷貝原子保證。

事務的字節選通信號不會影響單拷貝原子大小。

#### 多拷貝寫原子性

要指定一個系統提供多拷貝原子性，必須定義Multi_Copy_Atomicity屬性。

如果這個屬性被設置為True，則該系統擁有這個能力，否則該系統不擁有這個能力。

如果以下條件滿足，則可以說明一個系統具有多拷貝原子性：

* 針對同一個位置的寫操作可以被所有的代理以相同的順序觀察到。
* 對於一個除發出者外的代理可以觀測到的寫操作而言，其它的代理也都能觀測到。

多拷貝原子性可以通過如下手段來保證：

* 對於一個給定的地址使用單點序列化（POS），這樣針對相同位置的全部訪問操作都可以按序處理器，必須確保在該位置的新值針對任何代理都可見之前將被Cache的一致性拷貝全部無效化。
* 避免在代理的上游使用前向Buffer，這可以避免一個Buffer寫操作在對全部代理可見前對某些代理可見。

**注意：如果一個系統使用了ARM v8架構處理器，則該系統必須擁有Multi_Copy_Atomicity屬性。該屬性用來支持獲取加載和釋放存儲指令，釋放存儲指令要求存儲操作是多拷貝原子性的。**

### 獨佔訪問

獨佔訪問機制提供了信號量類型的操作，利用該機制時，不需要在整個訪問週期內讓總線被一個主設備所獨佔，這意味著信號量類型操作不會影響總線訪問延遲以及最大可實現帶寬。

AxLOCK信號選擇獨佔訪問，RRESP和BRESP信號則分別表示獨佔讀和獨佔寫操作的成功與否。

從設備要求額外的邏輯實現獨佔訪問，當主設備訪問一個不支持獨佔訪問的從設備時，AXI協議提供了一種機制用來通知該主設備其所訪問的從設備不支持獨佔訪問操作。

#### 獨佔訪問過程

獨佔訪問的基本機制如下：

1. 主設備在給定地址上執行獨佔讀事務。
2. 過一段時間後，主設備嘗試在相同的地址上執行獨佔寫事務，這會導致獨佔讀事務的完成，同時，獨佔寫事務的AWID與獨佔讀事務的ARID相同。
3. 如果從執行獨佔讀事務開始沒有其它主設備寫相同的位置，獨佔寫事務將會更新存儲器，並返回成功信號，否則會返回失敗信號。

主設備或許不會完成獨佔事務的寫部分，獨佔訪問監視硬件對於每一個事務ID只會監視一個地址。如果一個主設備沒有完成獨佔事務的寫部分，接下來這個主設備又以相同的事務ID對另一個地址發起了獨佔讀事務，則獨佔訪問監視的地址就會被改變。

#### 從主設備視角看待獨佔訪問

一個主設備通過執行一個獨佔讀事務的方式開始一個獨佔操作，如果事務成功，從設備就會返回EXOKAY響應，表示從設備已經記錄了要監視的地址。

如果主設備嘗試向不支持獨佔訪問的從設備發出獨佔讀事務請求，從設備會返回OKAY響應而不是EXOKAY響應。

**注意：主設備可以將OKAY響應作為獨佔訪問不支持的錯誤響應看待，規範推薦主設備接下來不要執行獨佔操作的寫部分。**

在獨佔讀操作之後的一段時間後，主設備嘗試對相同位置發起獨佔寫事務，如果從獨佔讀事務開始時到現在對應地址的內容始終沒有發生改變，獨佔寫操作就會成功，從設備返回EXOKAY響應，並更新對應的存儲器位置，否則，獨佔寫操作就會失敗，從設備返回OKAY響應而不是EXOKAY響應，獨佔寫操作不會更新對應的存儲器位置。

主設備或許不會完成獨佔操作的寫部分，如果發生了這種情況，從設備將會繼續監視獨佔訪問的地址直到針對該從設備的另一個獨佔讀事務啓動一個新的獨佔訪問序列。

主設備在獨佔訪問序列的讀部分完成後才會開始獨佔訪問序列的寫部分。

#### 從從設備視角看待獨佔訪問

不支持獨佔訪問的從設備可以忽略AxLOCK信號，這樣的從設備對於一般和獨佔訪問都必須提供OKAY響應信號。

支持獨佔訪問的從設備必須擁有監視硬件，規範推薦對於每一個支持獨佔的事務ID而言都準備一個監視單元。ARM規範參考手冊，ARMv7-A和ARMv7-R版本定義了一種獨佔訪問監視器，一個單端口的從設備可以擁有一個外接的獨佔訪問監視器，而一個多端口的從設備則或許需要實現內部監視器。

獨佔訪問監視器需要記錄任何獨佔讀操作的地址和ARID，然後需要監視指定的位置，直到針對該位置的寫操作發生或者使用相同ARID的另一個獨佔讀操作復位監視器並將地址設置為另一個值。

當從設備接收到一個獨佔寫事務時，監視器就會根據給定的AWID檢查指定的地址是否被監視，如果是，這表示從獨佔讀操作開始以來沒有發生寫操作，然後就會處理寫操作並完成整個獨佔訪問過程，返回EXOKAY響應，並更新存儲器。

如果在進行獨佔寫時，地址不再被相同AWID的監視硬件監視，則表明發生了下列情況之一：

* 在獨佔讀訪問事務發起之後，對應的位置的內容被更新。
* 監視器的地址被另一個獨佔讀事務重置修改。

在以上兩種情況中，獨佔寫事務都不會更新對應的存儲器位置，從設備必須返回OKAY而不是EXOKAY響應。

#### 獨佔訪問限制

獨佔訪問存在以下限制：

* 獨佔寫操作的突發大小和突發長度必須與其對應的獨佔讀操作一致。
* 獨佔訪問的地址必須對齊到事務的總字節數，也就是突發大小與突發長度的乘積。
* 獨佔讀與獨佔寫事務的地址必須一致。
* 獨佔讀事務的ARID必須與獨佔寫事務的AWID一致。
* 獨佔讀和獨佔寫事務的控制信號必須一致。
* 獨佔訪問突發傳輸的字節數必須是2的冪，即1、2、4、8、16、32、64或128字節。
* 獨佔訪問突發傳輸的最大字節數為128字節。
* 在AXI4中，獨佔訪問的突發長度不能超過16。
* AxCACHE信號的值必須保證監視獨佔訪問的從設備可以看到事務。例如，獨佔訪問事務的AxCACHE的值一定不表示事務是可Cache的。

不遵守這些限制將會導致**不可預測**的結果。

在獨佔操作過程中監視的最小字節數由事務的突發長度和突發大小所定義，而從設備可以選擇監視更大的字節數（最大不超過128字節），但當相鄰的字節被更新時，這會導致本應成功的獨佔訪問操作變為失敗狀態。

#### 不支持獨佔訪問的從設備

RRESP與BRESP響應信號在表示一般訪問成功時使用OKAY信號，而在表示獨佔訪問成功時使用EXOKAY信號，這意味著不支持獨佔訪問的從設備會使用OKAY信號表示獨佔訪問操作的失敗。

注意：

* 針對不支持獨佔訪問從設備的獨佔寫操作總會更新存儲器。
* 針對支持獨佔訪問從設備的獨佔寫操作只有在獨佔寫操作成功時才會更新存儲器。

### 鎖定訪問

AXI4不支持鎖定事務，而AXI3實現則必須支持鎖定事務。

AXI4由於以下原因移除了鎖定事務的支持：

* 大多數組件不需要鎖定事務。
* 鎖定事務的實現會對互聯器的複雜度以及QoS保證能力造成顯著的影響。

當主設備使用AxLOCK信號表示當前事務是一個鎖定事務時，互聯器就必須確保只有當前主設備可以訪問目標從設備區域，直到該主設備發出解鎖事務為止，互聯器的仲裁器必須強制執行此限制。

在主設備開始讀事務或寫事務的鎖定序列前，該主設備必須確保沒有其它等待完成的事務。

任何攜帶AxLOCK信號的事務都是鎖定事務，這會強制互聯器鎖定接下來的事務，因此，一個鎖定序列只有當主設備發出無AxLOCK信號事務時才會終止，這個終止事務包含在鎖定序列中並實際上移除了鎖。

在即將完成鎖定序列時，必須首先確保所有的鎖定事務都已經完成，然後才能發出終止解鎖事務，並必須確保在進行接下來的任何事務之前該解鎖事務已經執行完成。

主設備必須確保一個鎖定序列中的全部事務都擁有相同的AxID值。

**注意：鎖定訪問事務需要互聯器在鎖定序列進行中時避免任何其它的事務發生，這會對互聯器的效率產生影響，因此，該規範推薦鎖定訪問事務只用於支持早期設備。**

該規範推薦下列的限制（但不是強制性的）：

* 在單個4KB地址域內保持任何鎖定事務序列。
* 將任何鎖定任務序列限制為兩個事務。

### 原子訪問信號

在AXI3中，AxLOCK信號用於指定一般、獨佔和鎖定訪問，下表為AXI3規範對於AxLOCK信號的編碼：

| AxLOCK[1:0] | 訪問類型 |
| :---------: | :------: |
| 00 | 一般訪問 |
| 01 | 獨佔訪問 |
| 10 | 鎖定訪問 |
| 11 | 保留 |

AXI4移除了鎖定事務，僅使用1bit鎖定信號，下表為AXI4規範對於AxLOCK信號的編碼：

| AxLOCK | 訪問類型 |
| :----: | :------: |
| 0 | 一般訪問 |
| 1 | 獨佔訪問 |

#### 遺留問題

在AXI4環境中，任何AXI3鎖定事務可以按照下列方式被轉換：

* AWLOCK[1:0] = 10被轉換為一般寫事務，AWLOCK = 0。
* ARLOCK[1:0] = 10被轉換為一般讀事務，ARLOCK = 0。

該規範推薦任何組件執行這樣的轉換，一般是互聯器，可以包含一個可選的機制用於檢測和標記這樣的事務發生。

如果某些組件執行了這樣的轉換後不能正確工作，則這樣的組件不能在AXI4環境中使用。

**注意：對於許多早期使用鎖定事務的例子，例如SWP指令的執行，或許需要通過修改軟件的方式來避免使用強制使用鎖定事務的指令。**

## AXI4附加信號

### QoS信號

#### QoS接口信號

AXI4信號集支持兩個4bit的QoS標識符：

* AWQOS：一個4bit的QoS標識符，在每次寫事務中由寫地址通道發送。
* ARQOS：一個4bit的QoS標識符，在每次讀事務中由讀地址通道發送。

協議並沒有指定QoS標識符的精確使用方法，規範推薦AxQOS的值用於優先級指示器，更大的值表示更高優先級的事務。

當使用默認值0000時表示接口不參與任何QoS方案。

#### 主設備問題

一個主設備可以產生自己的AxQOS值，如果它可以產生多個傳輸流，則可以為這些流分配不同的QoS值。

為了支持QoS，需要對正在使用的QoS方案有系統級的理解，同時需要全部的組件之間互相配合，因此，規範推薦主設備組件支持精確控制QoS值的機制用於任何給定的場景。

如果主設備組件不支持任何可編程的QoS方案，則它可以使用QoS值代表事務的相對優先級，然後可以將這些值映射到備用的系統級QoS值。

不能產生AxQOS值的主設備必須使用默認值。

**注意：規範期望一些互聯組件實現一些可編程寄存器，這些寄存器可以用於分配QoS值到連接的主設備，覆蓋掉主設備原先的QoS值。**

#### 系統問題

AXI4中定義的QoS信號可以用於任何兼容的系統級QoS方法。

QoS默認的系統級實現是，任何組件可以選擇處理多個事務時，都會選擇QoS值較高的事務優先處理。這個選擇僅當沒有其他要求事務需要按特定順序處理的約束時才會發生。

**注意：這意味著AXI順序規則優先於QoS。**

可以實現兼容默認方案的更複雜的QoS方案。

### 多區域信號

#### 附加接口信號

AXI4接口信號集支持兩個4bit區域標識符（可選）：

* AWREGION：一個區域標識符，在每次寫事務中由寫地址通道發送。
* ARREGION：一個區域標識符，在每次讀事務中由讀地址通道發送。

4bit區域標識符可以用於唯一地標識16個不同的區域，區域標識符可以提供更高階的地址位譯碼，但在任何4KB地址空間內必須保持不變。

區域標識符的使用意味著從設備的單個物理接口可以提供多個邏輯接口，每一個都位於系統地址映射中的不同位置，區域標識符的使用也意味著從捨爾必不支持不同邏輯接口間的地址譯碼。

這個協議期望互聯器在為擁有多個邏輯接口的單個從設備執行地址譯碼功能時產生AxREGION信號，如果一個從設備在系統地址映射中只有一個物理接口，則互聯器必須使用默認的AxREGION值。

從設備必須確保兩個位於不同區域但擁有相同的AXI ID的事務以正確地順序響應。

如果從設備實現的區域少於16個時，從設備必須確保在任何主設備嘗試訪問不支持的區域時給出正確的協議信號，而這需要具體實現自行定義，例如，從設備或許需要通過下列方式來確保上述事宜：

* 對於任何訪問不支持區域的事務提供一個錯誤響應。
* 為所有不支持的區域分配支持區域的別名，以確保響應符合協議。

AxREGION信號僅提供了對從設備可使用的現存地址空間的地址譯碼功能，以消除對地址譯碼功能的需求，這個信號並沒有創建新的獨立地址空間。

AxREGION只能出現在地址譯碼功能的下游接口上。

### 用戶定義信號

AXI4接口信號集在每個通道上包含了一些用戶定義信號，一般情況下，規範推薦用戶不使用用戶信號，因為AXI協議並沒有定義這些信號的功能，貿然使用可能會導致兩個組件之間出現互操作性的問題，因為兩個組件可能以不兼容的方法使用了相同的用戶信號。

#### 信號命名

每個AXI4通道定義的用戶信號名稱如下：

* AWUSER：寫地址通道用戶信號。
* ARUSER：讀地址通道用戶信號。
* WUSER：寫數據通道用戶信號。
* RUSER：讀數據通道用戶信號。
* BUSER：寫響應通道用戶信號。

#### 使用問題

協議並不要求所有通道都支持用戶信號。

規範推薦互聯器包含用戶信號，然而，並沒有要求主設備和從設備包含用戶信號。

規範推薦互聯組件包含用戶信號的支持，以便互聯組件可以將用戶信號在主設備和從設備之間傳送，用戶定義信號的寬度是具體實現定義的，對於每個通道都可以是不同的。

## 低功耗接口

### 關於低功耗接口

低功耗接口是AXI協議的可選擴展，以如下兩類外設為目標：

* 任何沒有下電序列且可以指示其時鐘何時被關閉的外設。
* 任何要求下電序列，且只有在進入低功耗狀態後才能停止時鐘的外設，這樣的外設要求系統時鐘控制器指示其何時開始下電序列，並且外設在進入低功耗狀態後必須發出通知信號。

### 低功耗時鐘控制

低功耗時鐘控制接口包含如下信號：

* 一個來自外設的信號用於指示其時鐘何時可以被開啓關閉。
* 兩個為系統時鐘控制器準備的握手信號用於請求進入或退出低功耗狀態。

#### 外設時鐘要求

CACTIVE信號表示外設是否需要時鐘信號，當外設需要時鐘使能的時候就會拉高CACTIVE信號，此時系統時鐘控制器就必須立即使能時鐘。當外設不需要時鐘的時候就會拉低CACTIVE信號，系統時鐘控制器可以關閉該時鐘，但也可以不關閉。

如果一個外設在任何時候都允許其時鐘被使能或禁用，則可以永久性地拉低CATIVE信號，若一個外設要求其時鐘永久使能，則必須永久性地拉高CACTIVE信號。

CACTIVE僅用於沒有下電或上電序列支持的某些外設的時鐘控制。

#### 下電或上電握手

對於一個擁有下電或上電序列的外設而言，只有在系統時鐘控制器發出請求之後外設才會進入低功耗狀態，AXI協議提供了請求/響應握手信號用於支持這個功能：

* CSYSREQ：系統時鐘控制器使用CSYSREQ信號請求外設進入低功耗狀態（拉低CSYSREQ信號）或退出低功耗狀態（拉高CSYSREQ信號）。
* CSYSACK：外設使用CSYSACK信號通知系統時鐘控制器已完成請求，對於進入低功耗狀態請求，外設會拉低CSYSACK信號，對於退出低功耗狀態請求，外設會拉高CSYSACK信號。

下列是這CSYSREQ與CSYSACK信號的時序圖：

![avatar](pic/12.png)

在序列開始時，CSYSREQ與CSYSACK信號都為高電平，在T1時刻，系統時鐘控制器拉低CSYSREQ表示請求外設進入低功耗狀態，外設在T2時刻拉低CSYSACK信號響應請求，在T3時刻，系統時鐘控制器拉高CSYSREQ信號請求外設退出低功耗狀態，在T4時刻，外設拉高CSYSACK信號響應請求。

外設可以同意或拒絕系統時鐘控制器進入低功耗狀態的請求，在外設響應請求的時候通過將CACTIVE信號拉高或拉低來表示接受或拒絕請求。

#### 接受低功耗請求

下圖是外設接受系統低功耗請求時的時序圖：

![avatar](pic/13.png)

在T1時刻，系統時鐘控制器拉低CSYSREQ信號以請求外設進入低功耗狀態，在外設識別到這個請求後，執行了自己的下電序列，並在T2時刻拉低了CACTIVE信號用來表示時鐘信號可以被移除。在T3時刻，外設拉低CSYSACK信號通知系統時鐘控制器該外設已進入低功耗模式，

外設只有在拉低CACTIVE至少一個時鐘之後才能拉低CSYSACK信號。

#### 拒絕低功耗請求

下圖是外設拒絕系統低功耗請求時的時序圖：

![avatar](pic/14.png)

在T1時刻，系統時鐘控制器拉低CSYSREQ信號以請求外設進入低功耗狀態，在T2時刻外設響應該請求，但此時僅拉低了CSYSACK信號而並沒有拉低CACTIVE信號，因此系統時鐘控制器必須維持時鐘，並且在執行了低功耗狀態退出序列後才能發起另一個低功耗請求。在T3時刻，系統時鐘控制器通過拉高CSYSREQ開始了低功耗狀態退出序列，在T4時刻，外設拉高CSYSACK表示完成了低功耗狀態退出序列。

#### 退出低功耗狀態

無論是系統時鐘控制器還是外設都可以請求退出低功耗狀態，外設要求CACTIVE與CSYSREQ信號在整個低功耗狀態期間保持為低電平，這兩個信號之一變為高電平都會觸發低功耗狀態退出序列的啓動。

系統時鐘控制器觸發退出序列：

![avatar](pic/15.png)

在T1時刻，系統時鐘控制器拉高CSYSREQ信號以請求退出低功耗狀態，然後使能時鐘，外設識別到CSYSREQ信號為高電平後開始執行其自身的上電序列，並在T2時刻拉高CACTIVE信號表示它需要時鐘信號，然後外設在T3時刻拉高CSYSACK完成退出序列。

外設觸發退出序列：

![avatar](pic/16.png)

在T1時刻外設拉高CACTIVE信號以通知其需要時鐘信號，然後系統時鐘控制器必須恢復時鐘。

在T2時刻系統時鐘控制器拉高CSYSREQ信號以便繼續握手序列，外設接下來會拉高CSYSACK信號以完成退出序列。

**注意：外設可以讓CSYSACK保持數個週期的低電平以完成自身的退出序列。**

#### 組合低功耗域中的外設

系統時鐘控制器可以組合一些不同的外設到一個相同的低功耗時鐘域中，它可以將時鐘域看作一個單獨的外設，但要求下列規則必須遵守：

* 時鐘域的CACTIVE信號是時鐘域中所有外設CACTIVE信號的邏輯或，這意味著系統時鐘控制器只有當所有外設都表示其時鐘可以被關閉時才可以關閉時鐘。
* 系統控制器必須使用單個CSYSREQ信號路由到時鐘域中的全部外設。
* 時鐘域CSYSACK信號通過下述方法生成：只有當時鐘域中的最後一個外設拉低CSYSACK信號時才會拉低總的CSYSACK信號，只有當時鐘域中的最後一個外設拉高CSYSACK信號時才會拉高總的CSYSACK信號。

## 默認信號和互操作性

AXI協議並不要求一個組件使用AXI接口的完整可用信號集。

### 互操作性原則

下列互操作性原則針對AXI3和AXI4組件。

作為一個一般性原則，組件必須支持全部的輸入組合，但不必生成全部的輸出組合，例如，從設備必須支持不同可能突發長度，但主設備可以只生成它所用的突發類型，這個策略保證全部的組件都能配合其它的組件工作。

AXI接口可以省略信號的條件如下：

* 可選輸出：如果一個組件所需的值不與默認值匹配，組件就必須擁有其對應的輸出信號，如果一個組件總是需要默認值，則不需要組件存在實際的信號。
* 可選輸入：如果一個信號不需要被主設備或從設備觀測也能讓功能操作正確執行，則該輸入信號是可以忽略的。

**注意：互聯組件在合適的時候也可以忽略信號，例如，當一個信號僅輸出默認值，則該信號就不需要被互聯器轉發，該信號可以直接在其目的端生成，類似地，如果一個信號不被任何目的端所使用，那麼就不需要互聯器轉發該信號。**

### 主要接口類別

#### 讀寫接口

讀寫接口包含下列AXI通道：

* AR：讀地址通道。
* R：讀數據通道。
* AW：寫地址通道。
* W：寫數據通道。
* B：寫響應通道。

#### 只讀接口

只讀接口僅支持讀事務，因此只包含下述通道：

* AR：讀地址通道。
* R：讀數據通道。

**注意：只讀接口不支持獨佔訪問。**

#### 只寫接口

只寫接口僅支持寫事務，因此只包含下述通道：

* AW：寫地址通道。
* W：寫數據通道。
* B：寫響應通道。

**注意：只寫接口不支持獨佔訪問。**

#### 存儲器從設備和外設從設備

AXI從設備分為存儲器從設備與外設從設備。

存儲器從設備必須正確地處理全部事務類型。

規範期望外設從設備擁有一個定義的訪問方法，該方法建立了可以用於訪問設備的事務類型以及對設備訪問方式的限制。通常，定義的訪問方法在組件的datasheet中描述，任何未定義的訪問方法或許都會造成外設從設備失敗，但規範期望以協議兼容的失敗-安全方法完成訪問以避免系統死鎖，但不要求外設從設備繼續進行正確的操作。

因為只有當使用外設定義的訪問方法時才要求外設正常工作，因此外設從設備可以擁有接口信號的極小子集。

**注意：規範期望所有外設都支持C語言定義的訪問方法，如8bit/16bit/32bit對齊訪問事務。並不存在要求支持的最小子集，因為每個組件支持的事務子集都可以不同，例如，一個外設可能只支持16bit訪問事務，但另一個外設只支持32bit訪問事務。**

### 默認信號值

規範建議，一般而言，為了最大限度地重用IP，一個AXI組件接口包含所有的信號，這樣就降低了設計流程中系統集成階段出現錯誤的風險，它還可以幫助一些不能有效支持缺少信號的默認值的設計流程。

下列的幾個表展示了AXI強制和可選信號，同時給出了可選信號的默認值。

主接口寫通道信號和默認值：

| 信號 | 描述 | 方向 | 是否強制 | 默認值 |
| :------: | :----------: | :---: | :------: | :-----------: |
| ACLK | 公共時鐘 | 輸入 | 強制 | - |
| ARESETn | 公共復位 | 輸入 | 強制 | - |
| AWID | 寫地址ID | 輸出 | 可選 | 全0 |
| AWADDR | 寫地址 | 輸出 | 強制 | - |
| AWREGION | 寫區域 | 輸出 | 可選 | 全0 |
| AWLEN | 突發長度 | 輸出 | 可選 | 全0，長度1 |
| AWSIZE | 突發大小 | 輸出 | 可選 | 數據總線寬度 |
| AWBURST | 突發類型 | 輸出 | 可選 | 01，遞增模式 |
| AWLOCK | 鎖定類型 | 輸出 | 可選 | 全0，一般訪問 |
| AWCACHE | Cache類型 | 輸出 | 可選 | 0000 |
| AWPROT | 保護類型 | 輸出 | 強制 | - |
| AWQOS | QoS值 | 輸出 | 可選 | 0000 |
| AWVALID | 寫地址有效 | 輸出 | 強制 | - |
| AWREADY | 寫地址準備好 | 輸入 | 強制 | - |
| WDATA | 寫數據 | 輸出 | 強制 | - |
| WSTRB | 寫字節使能 | 輸出 | 可選 | 全0 |
| WLAST | 寫最後 | 輸出 | 強制 | - |
| WVALID | 寫有效 | 輸出 | 強制 | - |
| WREADY | 寫準備好 | 輸入 | 強制 | - |
| BID | 響應ID | 輸入 | 可選 | - |
| BRESP | 寫響應 | 輸入 | 可選 | - |
| BVALID | 寫響應有效 | 輸入 | 強制 | - |
| BREADY | 響應準備好 | 輸出 | 強制 | - |

存儲器從接口寫通道信號和默認值：

| 信號 | 描述 | 方向 | 是否強制 | 默認值 |
| :------: | :----------: | :---: | :------: | :------: |
| ACLK | 公共時鐘 | 輸入 | 強制 | - |
| ARESETn | 公共復位 | 輸入 | 強制 | - |
| AWID | 寫地址ID | 輸入 | 強制 | - |
| AWADDR | 寫地址 | 輸入 | 強制 | - |
| AWREGION | 寫區域 | 輸入 | 可選 | - |
| AWLEN | 突發長度 | 輸入 | 強制 | - |
| AWSIZE | 突發大小 | 輸入 | 強制 | - |
| AWBURST | 突發類型 | 輸入 | 強制 | - |
| AWLOCK | 鎖定類型 | 輸入 | 可選 | - |
| AWCACHE | Cache類型 | 輸入 | 可選 | - |
| AWPROT | 保護類型 | 輸入 | 可選 | - |
| AWQOS | QoS值 | 輸入 | 可選 | - |
| AWVALID | 寫地址有效 | 輸入 | 強制 | - |
| AWREADY | 寫地址準備好 | 輸出 | 強制 | - |
| WDATA | 寫數據 | 輸入 | 強制 | - |
| WSTRB | 寫字節使能 | 輸入 | 強制 | - |
| WLAST | 寫最後 | 輸入 | 可選 | - |
| WVALID | 寫有效輸入 | 輸入 | 強制 | - |
| WREADY | 寫準備好 | 輸出 | 強制 | - |
| BID | 響應ID | 輸出 | 強制 | - |
| BRESP | 寫響應 | 輸出 | 可選 | 00，OKAY |
| BVALID | 寫響應有效 | 輸出 | 強制 | - |
| BREADY | 響應準備好 | 輸入 | 強制 | - |

主接口讀通道信號和默認值：

| 信號 | 描述 | 方向 | 是否強制 | 默認值 |
| :------: | :----------: | :---: | :------: | :-----------: |
| ARID | 讀地址ID | 輸出 | 可選 | 全0 |
| ARADDR | 讀地址 | 輸出 | 強制 | - |
| ARREGION | 讀區域 | 輸出 | 可選 | 0x0 |
| ARLEN | 突發長度 | 輸出 | 可選 | 全0，長度1 |
| ARSIZE | 突發大小 | 輸出 | 可選 | 數據總線寬度 |
| ARBURST | 突發類型 | 輸出 | 可選 | 01，遞增模式 |
| ARLOCK | 鎖定類型 | 輸出 | 可選 | 全0，一般訪問 |
| ARCACHE | Cache類型 | 輸出 | 可選 | 0000 |
| ARPROT | 保護類型 | 輸出 | 強制 | - |
| ARQOS | QoS值 | 輸出 | 可選 | 0000 |
| ARVALID | 讀地址有效 | 輸出 | 強制 | - |
| ARREADY | 讀地址準備好 | 輸入 | 強制 | - |
| RID | 讀數據ID | 輸入 | 可選 | - |
| RDATA | 讀數據 | 輸入 | 強制 | - |
| RRESP | 讀響應 | 輸入 | 可選 | - |
| RLAST | 讀最後 | 輸入 | 可選 | - |
| RVALID | 讀有效 | 輸入 | 強制 | - |
| RREADY | 讀準備好 | 輸出 | 強制 | - |

存儲器從接口讀通道信號和默認值：

| 信號 | 描述 | 方向 | 是否強制 | 默認值 |
| :------: | :----------: | :---: | :------: | :------: |
| ARID | 讀地址ID | 輸入 | 強制 | - |
| ARADDR | 讀地址 | 輸入 | 強制 | - |
| ARREGION | 讀區域 | 輸入 | 可選 | - |
| ARLEN | 突發長度 | 輸入 | 強制 | - |
| ARSIZE | 突發大小 | 輸入 | 強制 | - |
| ARBURST | 突發類型 | 輸入 | 強制 | - |
| ARLOCK | 鎖定類型 | 輸入 | 可選 | - |
| ARCACHE | Cache類型 | 輸入 | 可選 | - |
| ARPROT | 保護類型 | 輸入 | 可選 | - |
| ARQOS | QoS值 | 輸入 | 可選 | - |
| ARVALID | 讀地址有效 | 輸入 | 強制 | - |
| ARREADY | 讀地址準備好 | 輸出 | 強制 | - |
| RID | 讀數據ID | 輸出 | 強制 | - |
| RDATA | 讀數據 | 輸出 | 強制 | - |
| RRESP | 讀響應 | 輸出 | 可選 | 00，OKAY |
| RLAST | 讀最後 | 輸出 | 強制 | - |
| RVALID | 讀有效 | 輸出 | 強制 | - |
| RREADY | 讀準備好 | 輸入 | 強制 | - |

#### 主設備地址

AxADDR：規範並沒有規定該信號的最小長度，如果系統地址總線比主設備地址信號更寬，則額外的高地址位全部設為0，如果更窄，則多餘的高地址位不能連接到系統地址總線。

**注意：一般情況下主設備支持32bit地址，主設備可選支持到至多64bit地址。**

#### 從設備地址

AxADDR：規範並沒有規定該信號的最小長度，同時規範也不要求從設備對系統數據總線寬度內的數據使用低地址位進行尋址，並假設這些低地址位為全0，如果從設備的地址線比互聯器更寬，則多餘的高低地址位默認全0。

通常一個存儲器從設備至少能夠完全譯碼整個4KB地址空間。

#### 存儲器從設備

AxLOCK：規範不要求存儲器從設備使用AxLOCK輸入信號，然而，支持獨佔訪問事務的存儲器從設備需要這些信號。

AxCACHE：規範不要求存儲器從設備使用AxCACHE信號，如果一個存儲器從設備不支持Cache行為或所有的事務以相同的方式Cache，則該設備不需要這個信號。

#### 寫事務

WSTRB[3:0]：如果主設備總是執行整個數據總線寬度的寫事務，則規範不要求主設備使用寫字節使能信號，寫字節使能的默認值是全1。

WLAST：規範不要求從設備使用WLAST信號，因為已定義寫突發長度，從設備可以根據突發長度AWLEN[7:0]信號計算出最後一次寫數據傳輸。

#### 讀事務

RLAST：規範不要求主設備使用RLAST信號，因為已定義讀突發長度，主設備可以根據突發長度ARLEN[7:0]信號計算出最後一次讀數據傳輸。

#### 響應信號

RRESP，BRESP：如果主設備不需要執行獨佔訪問事務也不需要事務錯誤通知，則主設備可以不使用RRESP與BRESP輸入信號；如果從設備不需要支持獨佔訪問事務也不需要生成錯誤響應，則從設備可以不使用RRESP與BRESP輸出信號。

#### 不安全和安全訪問

AxPROT：規範不要求從設備區分非安全和安全訪問，也不要求任何額外的保護支持，因此不要求從設備支持AxPROT輸入信號。

**注意：要特別注意AxPROT信號，AxPROT[1]信號表示事務是否為安全事務，不正確的設置可能會導致不正確的系統行為。**
